import{V as S,w as L,x as He,z as D,B as b,C as Be,D as Fe}from"./index.0e117cfb.js";import"./modulepreload-polyfill.b7f2da20.js";const Ue=`.netless-app-docs-viewer-footer{box-sizing:border-box;height:26px;display:flex;align-items:center;padding:0 16px;border-top:1px solid #eeeef7;font-family:PingFang SC,Source Han Sans SC,Microsoft YaHei,Helvetica Neue,Noto Sans CJK SC,WenQuanYi Micro Hei,sans-serif}.netless-app-docs-viewer-footer-btn{box-sizing:border-box;width:26px;height:26px;font-size:0;margin:0;padding:3px;border:none;border-radius:1px;outline:none;color:currentColor;background:transparent;transition:background .4s;cursor:pointer;user-select:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}.netless-app-docs-viewer-footer-btn:hover{background:rgba(237,237,240,.9)}@media (hover: none){.netless-app-docs-viewer-footer-btn:hover{background:transparent!important}}.netless-app-docs-viewer-footer-btn>svg{width:100%;height:100%}.netless-app-docs-viewer-footer-btn>svg:nth-of-type(2){display:none}.netless-app-docs-viewer-footer-btn.netless-app-docs-viewer-footer-btn-playing>svg:nth-of-type(1){display:none}.netless-app-docs-viewer-footer-btn.netless-app-docs-viewer-footer-btn-playing>svg:nth-of-type(2){display:initial}.netless-app-docs-viewer-footer-btn~.netless-app-docs-viewer-footer-btn{margin-left:15px}.netless-app-docs-viewer-page-jumps{flex:1;display:flex;justify-content:center;align-items:center}.netless-app-docs-viewer-page-number{display:flex;align-items:center;height:26px;margin-left:auto;font-size:13px;white-space:nowrap;word-break:keep-all;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.netless-app-docs-viewer-page-number-input{border:none;outline:none;width:3em;margin:0;padding:0 .5em 0 2px;text-align:right;font-size:13px;line-height:1;font-weight:400;font-family:inherit;border-radius:2px;color:currentColor;font-family:PingFang SC,Source Han Sans SC,Microsoft YaHei,Helvetica Neue,Noto Sans CJK SC,WenQuanYi Micro Hei,sans-serif;background:transparent;transition:background .4s;-webkit-tap-highlight-color:rgba(0,0,0,0)}.netless-app-docs-viewer-page-number-input:hover,.netless-app-docs-viewer-page-number-input:focus,.netless-app-docs-viewer-page-number-input:active{user-select:text;background:#fff;box-shadow:#63636333 0 2px 8px}.netless-app-docs-viewer-readonly .netless-app-docs-viewer-footer-btn{cursor:not-allowed}.netless-app-docs-viewer-readonly .netless-app-docs-viewer-footer-btn:hover{background:transparent}.netless-app-docs-viewer-readonly .netless-app-docs-viewer-page-number-input{cursor:not-allowed}.netless-app-docs-viewer-readonly .netless-app-docs-viewer-page-number-input:hover,.netless-app-docs-viewer-readonly .netless-app-docs-viewer-page-number-input:focus,.netless-app-docs-viewer-readonly .netless-app-docs-viewer-page-number-input:active{background:transparent;box-shadow:none}.netless-app-docs-viewer-readonly .netless-app-docs-viewer-page-number-input:disabled{color:inherit}.telebox-color-scheme-dark .netless-app-docs-viewer-page-number-input:active,.telebox-color-scheme-dark .netless-app-docs-viewer-page-number-input:focus,.telebox-color-scheme-dark .netless-app-docs-viewer-page-number-input:hover{color:currentColor;background:#25282e}.telebox-color-scheme-dark .netless-app-docs-viewer-footer{border-top:none}.telebox-color-scheme-dark .netless-app-docs-viewer-footer-btn:hover{background:#212126}.netless-app-docs-viewer-preview-mask{position:absolute;z-index:10200;top:0;left:0;width:100%;height:100%}.netless-app-docs-viewer-preview{box-sizing:border-box;display:flex;flex-direction:column;align-items:center;position:absolute;z-index:10300;top:0;left:0;width:33%;max-width:200px;height:100%;padding-top:10px;transform:translate(-100%);background:rgba(237,237,240,.9);box-shadow:inset -1px 0 #0000001c;transition:transform .4s;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.netless-app-docs-viewer-preview.netless-app-docs-viewer-preview-active{transform:translate(0)}.netless-app-docs-viewer-preview-page{position:relative;display:block;width:55%;margin-bottom:10px;font-size:0;color:transparent;outline:none;border:7px solid transparent;border-radius:4px;transition:border-color .3s;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.netless-app-docs-viewer-preview-page:hover,.netless-app-docs-viewer-preview-page.netless-app-docs-viewer-preview-page-active{border-color:#444e601a}.netless-app-docs-viewer-preview-page>img{width:100%;height:auto;box-sizing:border-box;border:1px solid rgba(0,0,0,.5);border-radius:1px;background-color:#fff;box-shadow:0 2px 8px #0000004d}.netless-app-docs-viewer-preview-page-name{position:absolute;top:1px;left:-10px;transform:translate(-100%);text-align:right;font-size:12px;color:#5f5f5f;user-select:none}.telebox-color-scheme-dark .netless-app-docs-viewer-preview{background:rgba(50,50,50,.9)}.netless-app-docs-viewer-content{position:relative;height:100%;overflow:hidden}.netless-app-docs-viewer-static-scrollbar{box-sizing:border-box;position:absolute;top:0;right:0;z-index:2147483647;width:16px;min-height:30px;margin:0;padding:0 0 0 8px;border:none;outline:none;opacity:0;background:transparent;transition:opacity .4s 3s,transform .1s;user-select:none;touch-action:none}.netless-app-docs-viewer-static-scrollbar:after{content:"";display:block;width:8px;height:100%;border-radius:4px;background:rgba(68,78,96,.4);box-shadow:1px 1px 8px #ffffffb3;transition:background .4s}.netless-app-docs-viewer-static-scrollbar.netless-app-docs-viewer-static-scrolling{opacity:1;transition:opacity .4s,transform .1s}.netless-app-docs-viewer-static-scrollbar.netless-app-docs-viewer-static-scrollbar-dragging{opacity:1;transition:opacity .4s 3s!important}.netless-app-docs-viewer-static-scrollbar.netless-app-docs-viewer-static-scrollbar-dragging:after{background:rgba(68,78,96,.6)}.netless-app-docs-viewer-static-scrollbar:hover:after,.netless-app-docs-viewer-static-scrollbar:focus:after{background:rgba(68,78,96,.5)}.netless-app-docs-viewer-static-scrollbar:active:after{background:rgba(68,78,96,.6)}.telebox-body-wrap:hover .netless-app-docs-viewer-static-scrollbar{opacity:1;transition:opacity .4s,transform .1s}.telebox-readonly .netless-app-docs-viewer-static-scrollbar{display:none}.page-renderer-pages-container{position:relative;width:100%;height:100%}.page-renderer-page{position:absolute;top:0;left:0;background-position:center;background-size:cover;background-repeat:no-repeat}.page-renderer-pages-container.is-hwa .page-renderer-page{will-change:transform}.page-renderer-page-img{display:block;width:100%;height:auto;user-select:none}.netless-app-docs-viewer-static-pages{overflow:hidden;position:relative;height:100%;user-select:none}.netless-app-docs-viewer-static-page{display:block;width:100%;height:auto;user-select:none}.netless-app-docs-viewer-dynamic-wb-view{position:absolute;top:0;left:0;width:100%;height:100%;z-index:100;overflow:hidden}.netless-app-docs-viewer-dynamic-wb-view .cursor-clicker .ppt-event-source{cursor:pointer}
`,_=typeof window<"u",le=_&&!("onscroll"in window)||typeof navigator<"u"&&/(gle|ing|ro)bot|crawl|spider/i.test(navigator.userAgent),de=_&&"IntersectionObserver"in window,he=_&&"classList"in document.createElement("p"),pe=_&&window.devicePixelRatio>1,We={elements_selector:".lazy",container:le||_?document:null,threshold:300,thresholds:null,data_src:"src",data_srcset:"srcset",data_sizes:"sizes",data_bg:"bg",data_bg_hidpi:"bg-hidpi",data_bg_multi:"bg-multi",data_bg_multi_hidpi:"bg-multi-hidpi",data_bg_set:"bg-set",data_poster:"poster",class_applied:"applied",class_loading:"loading",class_loaded:"loaded",class_error:"error",class_entered:"entered",class_exited:"exited",unobserve_completed:!0,unobserve_entered:!1,cancel_on_exit:!0,callback_enter:null,callback_exit:null,callback_applied:null,callback_loading:null,callback_loaded:null,callback_error:null,callback_finish:null,callback_cancel:null,use_native:!1,restore_on_error:!1},ue=e=>Object.assign({},We,e),re=function(e,t){let s;const r="LazyLoad::Initialized",i=new e(t);try{s=new CustomEvent(r,{detail:{instance:i}})}catch{s=document.createEvent("CustomEvent"),s.initCustomEvent(r,!1,!1,{instance:i})}window.dispatchEvent(s)},Ye=(e,t)=>{if(!!t)if(!t.length)re(e,t);else for(let s=0,r;r=t[s];s+=1)re(e,r)},E="src",W="srcset",Y="sizes",ge="poster",z="llOriginalAttrs",fe="data",j="loading",we="loaded",be="applied",je="entered",G="error",ve="native",me="data-",Se="ll-status",w=(e,t)=>e.getAttribute(me+t),Ge=(e,t,s)=>{var r=me+t;if(s===null){e.removeAttribute(r);return}e.setAttribute(r,s)},M=e=>w(e,Se),N=(e,t)=>Ge(e,Se,t),O=e=>N(e,null),q=e=>M(e)===null,qe=e=>M(e)===j,Je=e=>M(e)===G,J=e=>M(e)===ve,Xe=[j,we,be,G],Ke=e=>Xe.indexOf(M(e))>=0,C=(e,t,s,r)=>{if(!!e){if(r!==void 0){e(t,s,r);return}if(s!==void 0){e(t,s);return}e(t)}},I=(e,t)=>{if(he){e.classList.add(t);return}e.className+=(e.className?" ":"")+t},m=(e,t)=>{if(he){e.classList.remove(t);return}e.className=e.className.replace(new RegExp("(^|\\s+)"+t+"(\\s+|$)")," ").replace(/^\s+/,"").replace(/\s+$/,"")},Qe=e=>{e.llTempImage=document.createElement("IMG")},Ze=e=>{delete e.llTempImage},Ee=e=>e.llTempImage,H=(e,t)=>{if(!t)return;const s=t._observer;!s||s.unobserve(e)},et=e=>{e.disconnect()},tt=(e,t,s)=>{t.unobserve_entered&&H(e,s)},X=(e,t)=>{!e||(e.loadingCount+=t)},st=e=>{!e||(e.toLoadCount-=1)},ye=(e,t)=>{!e||(e.toLoadCount=t)},rt=e=>e.loadingCount>0,it=e=>e.toLoadCount>0,$e=e=>{let t=[];for(let s=0,r;r=e.children[s];s+=1)r.tagName==="SOURCE"&&t.push(r);return t},K=(e,t)=>{const s=e.parentNode;if(!s||s.tagName!=="PICTURE")return;$e(s).forEach(t)},xe=(e,t)=>{$e(e).forEach(t)},B=[E],_e=[E,ge],P=[E,W,Y],Ce=[fe],F=e=>!!e[z],ke=e=>e[z],Le=e=>delete e[z],T=(e,t)=>{if(F(e))return;const s={};t.forEach(r=>{s[r]=e.getAttribute(r)}),e[z]=s},at=e=>{F(e)||(e[z]={backgroundImage:e.style.backgroundImage})},ot=(e,t,s)=>{if(!s){e.removeAttribute(t);return}e.setAttribute(t,s)},k=(e,t)=>{if(!F(e))return;const s=ke(e);t.forEach(r=>{ot(e,r,s[r])})},nt=e=>{if(!F(e))return;const t=ke(e);e.style.backgroundImage=t.backgroundImage},Ne=(e,t,s)=>{I(e,t.class_applied),N(e,be),s&&(t.unobserve_completed&&H(e,t),C(t.callback_applied,e,s))},Te=(e,t,s)=>{I(e,t.class_loading),N(e,j),s&&(X(s,1),C(t.callback_loading,e,s))},x=(e,t,s)=>{!s||e.setAttribute(t,s)},ie=(e,t)=>{x(e,Y,w(e,t.data_sizes)),x(e,W,w(e,t.data_srcset)),x(e,E,w(e,t.data_src))},ct=(e,t)=>{K(e,s=>{T(s,P),ie(s,t)}),T(e,P),ie(e,t)},lt=(e,t)=>{T(e,B),x(e,E,w(e,t.data_src))},dt=(e,t)=>{xe(e,s=>{T(s,B),x(s,E,w(s,t.data_src))}),T(e,_e),x(e,ge,w(e,t.data_poster)),x(e,E,w(e,t.data_src)),e.load()},ht=(e,t)=>{T(e,Ce),x(e,fe,w(e,t.data_src))},pt=(e,t,s)=>{const r=w(e,t.data_bg),i=w(e,t.data_bg_hidpi),a=pe&&i?i:r;!a||(e.style.backgroundImage=`url("${a}")`,Ee(e).setAttribute(E,a),Te(e,t,s))},ut=(e,t,s)=>{const r=w(e,t.data_bg_multi),i=w(e,t.data_bg_multi_hidpi),a=pe&&i?i:r;!a||(e.style.backgroundImage=a,Ne(e,t,s))},gt=(e,t,s)=>{const r=w(e,t.data_bg_set);if(!r)return;const i=r.split("|");let a=i.map(n=>`image-set(${n})`);e.style.backgroundImage=a.join(),e.style.backgroundImage===""&&(a=i.map(n=>`-webkit-image-set(${n})`),e.style.backgroundImage=a.join()),Ne(e,t,s)},Ie={IMG:ct,IFRAME:lt,VIDEO:dt,OBJECT:ht},ft=(e,t)=>{const s=Ie[e.tagName];!s||s(e,t)},wt=(e,t,s)=>{const r=Ie[e.tagName];!r||(r(e,t),Te(e,t,s))},bt=["IMG","IFRAME","VIDEO","OBJECT"],vt=e=>bt.indexOf(e.tagName)>-1,Ae=(e,t)=>{t&&!rt(t)&&!it(t)&&C(e.callback_finish,t)},ae=(e,t,s)=>{e.addEventListener(t,s),e.llEvLisnrs[t]=s},mt=(e,t,s)=>{e.removeEventListener(t,s)},Q=e=>!!e.llEvLisnrs,St=(e,t,s)=>{Q(e)||(e.llEvLisnrs={});const r=e.tagName==="VIDEO"?"loadeddata":"load";ae(e,r,t),ae(e,"error",s)},U=e=>{if(!Q(e))return;const t=e.llEvLisnrs;for(let s in t){const r=t[s];mt(e,s,r)}delete e.llEvLisnrs},De=(e,t,s)=>{Ze(e),X(s,-1),st(s),m(e,t.class_loading),t.unobserve_completed&&H(e,s)},Et=(e,t,s,r)=>{const i=J(t);De(t,s,r),I(t,s.class_loaded),N(t,we),C(s.callback_loaded,t,r),i||Ae(s,r)},yt=(e,t,s,r)=>{const i=J(t);De(t,s,r),I(t,s.class_error),N(t,G),C(s.callback_error,t,r),s.restore_on_error&&k(t,P),i||Ae(s,r)},Z=(e,t,s)=>{const r=Ee(e)||e;if(Q(r))return;St(r,n=>{Et(n,e,t,s),U(r)},n=>{yt(n,e,t,s),U(r)})},$t=(e,t,s)=>{Qe(e),Z(e,t,s),at(e),pt(e,t,s),ut(e,t,s),gt(e,t,s)},xt=(e,t,s)=>{Z(e,t,s),wt(e,t,s)},ee=(e,t,s)=>{vt(e)?xt(e,t,s):$t(e,t,s)},_t=(e,t,s)=>{e.setAttribute("loading","lazy"),Z(e,t,s),ft(e,t),N(e,ve)},oe=e=>{e.removeAttribute(E),e.removeAttribute(W),e.removeAttribute(Y)},Ct=e=>{K(e,t=>{oe(t)}),oe(e)},Pe=e=>{K(e,t=>{k(t,P)}),k(e,P)},kt=e=>{xe(e,t=>{k(t,B)}),k(e,_e),e.load()},Lt=e=>{k(e,B)},Nt=e=>{k(e,Ce)},Tt={IMG:Pe,IFRAME:Lt,VIDEO:kt,OBJECT:Nt},It=e=>{const t=Tt[e.tagName];if(!t){nt(e);return}t(e)},At=(e,t)=>{q(e)||J(e)||(m(e,t.class_entered),m(e,t.class_exited),m(e,t.class_applied),m(e,t.class_loading),m(e,t.class_loaded),m(e,t.class_error))},Dt=(e,t)=>{It(e),At(e,t),O(e),Le(e)},Pt=(e,t,s,r)=>{!s.cancel_on_exit||!qe(e)||e.tagName==="IMG"&&(U(e),Ct(e),Pe(e),m(e,s.class_loading),X(r,-1),O(e),C(s.callback_cancel,e,t,r))},zt=(e,t,s,r)=>{const i=Ke(e);N(e,je),I(e,s.class_entered),m(e,s.class_exited),tt(e,s,r),C(s.callback_enter,e,t,r),!i&&ee(e,s,r)},Mt=(e,t,s,r)=>{q(e)||(I(e,s.class_exited),Pt(e,t,s,r),C(s.callback_exit,e,t,r))},Vt=["IMG","IFRAME","VIDEO"],ze=e=>e.use_native&&"loading"in HTMLImageElement.prototype,Rt=(e,t,s)=>{e.forEach(r=>{Vt.indexOf(r.tagName)!==-1&&_t(r,t,s)}),ye(s,0)},Ot=e=>e.isIntersecting||e.intersectionRatio>0,Ht=e=>({root:e.container===document?null:e.container,rootMargin:e.thresholds||e.threshold+"px"}),Bt=(e,t,s)=>{e.forEach(r=>Ot(r)?zt(r.target,r,t,s):Mt(r.target,r,t,s))},Ft=(e,t)=>{t.forEach(s=>{e.observe(s)})},Ut=(e,t)=>{et(e),Ft(e,t)},Wt=(e,t)=>{!de||ze(e)||(t._observer=new IntersectionObserver(s=>{Bt(s,e,t)},Ht(e)))},Me=e=>Array.prototype.slice.call(e),R=e=>e.container.querySelectorAll(e.elements_selector),Yt=e=>Me(e).filter(q),jt=e=>Je(e),Gt=e=>Me(e).filter(jt),ne=(e,t)=>Yt(e||R(t)),qt=(e,t)=>{Gt(R(e)).forEach(r=>{m(r,e.class_error),O(r)}),t.update()},Jt=(e,t)=>{!_||(t._onlineHandler=()=>{qt(e,t)},window.addEventListener("online",t._onlineHandler))},Xt=e=>{!_||window.removeEventListener("online",e._onlineHandler)},V=function(e,t){const s=ue(e);this._settings=s,this.loadingCount=0,Wt(s,this),Jt(s,this),this.update(t)};V.prototype={update:function(e){const t=this._settings,s=ne(e,t);if(ye(this,s.length),le||!de){this.loadAll(s);return}if(ze(t)){Rt(s,t,this);return}Ut(this._observer,s)},destroy:function(){this._observer&&this._observer.disconnect(),Xt(this),R(this._settings).forEach(e=>{Le(e)}),delete this._observer,delete this._settings,delete this._onlineHandler,delete this.loadingCount,delete this.toLoadCount},loadAll:function(e){const t=this._settings;ne(e,t).forEach(r=>{H(r,this),ee(r,t,this)})},restoreAll:function(){const e=this._settings;R(e).forEach(t=>{Dt(t,e)})}};V.load=(e,t)=>{const s=ue(t);ee(e,s)};V.resetStatus=e=>{O(e)};_&&Ye(V,window.lazyLoadOptions);class Kt{constructor({namespace:t,pages$:s,sideEffect:r,readonly$:i,events:a,wrapClassName:n,root:c,pagesIndex$:l}){this.showPreview$=new S(!1),this.namespace=t,this.pages$=s,this.sideEffect=r,this.readonly$=i,this.events=a,this.wrapClassName=n,this.sideEffect.addDisposer(this.events.on("togglePreview",()=>{this.showPreview$.setValue(!this.showPreview$.value)})),this.sideEffect.addDisposer(this.showPreview$.subscribe(o=>{this.sideEffect.add(()=>{const d=this.renderPreview(),p=this.renderPreviewMask();if(o){c.appendChild(d),c.appendChild(p),d.scrollTop;const u=d.querySelector("."+this.wrapClassName(`preview-page-${l.value}`));return u&&d.scrollTo({top:u.offsetTop-16}),d.classList.toggle(this.wrapClassName("preview-active"),!0),this.previewLazyLoad=new V({container:this.$preview,elements_selector:"."+this.wrapClassName("preview-page>img")}),()=>{var h;return(h=this.previewLazyLoad)==null?void 0:h.destroy()}}else return d.classList.toggle(this.wrapClassName("preview-active"),!1),this.sideEffect.setTimeout(()=>{d.remove(),p.remove()},500,"preview-remove"),null},"preview-lazyload")}))}destroy(){var t,s;(t=this.$preview)==null||t.remove(),(s=this.$previewMask)==null||s.remove()}renderPreview(){if(this.$preview)return this.$preview;const t=document.createElement("div");return t.className=this.wrapClassName("preview")+" tele-fancy-scrollbar",this.$preview=t,this.sideEffect.addEventListener(t,"wheel",s=>s.stopPropagation(),{passive:!1}),this.sideEffect.addDisposer(this.pages$.subscribe(s=>{var r;this.sideEffect.add(()=>{const i=s.map((a,n)=>{var u;const c=(u=a.thumbnail)!=null?u:a.src.startsWith("ppt")?void 0:a.src;if(!c)return;const l=String(n),o=document.createElement("a");o.className=this.wrapClassName("preview-page")+" "+this.wrapClassName(`preview-page-${n}`),o.setAttribute("href","#"),o.dataset.pageIndex=l;const d=document.createElement("span");d.className=this.wrapClassName("preview-page-name"),d.textContent=String(n+1),d.dataset.pageIndex=l;const p=document.createElement("img");return p.width=a.width,p.height=a.height,p.dataset.src=c,p.dataset.pageIndex=l,o.appendChild(p),o.appendChild(d),t.appendChild(o),o});return()=>i.forEach(a=>a==null?void 0:a.remove())},"render-preview-pages"),(r=this.previewLazyLoad)==null||r.update()})),this.sideEffect.addEventListener(t,"click",s=>{var i;if(this.readonly$.value)return;const r=(i=s.target.dataset)==null?void 0:i.pageIndex;r&&(s.preventDefault(),s.stopPropagation(),s.stopImmediatePropagation(),this.events.emit("jumpPage",Number(r)),this.showPreview$.setValue(!1))}),t}renderPreviewMask(){if(this.$previewMask)return this.$previewMask;const t=document.createElement("div");return t.className=this.wrapClassName("preview-mask"),this.$previewMask=t,this.sideEffect.addEventListener(t,"click",s=>{this.readonly$.value||s.target===t&&this.showPreview$.setValue(!1)}),t}}function Qt(e){const t="http://www.w3.org/2000/svg",s=document.createElementNS(t,"svg");s.setAttribute("class",`${e}-footer-icon-sidebar`),s.setAttribute("viewBox","0 0 64 64");const r=document.createElementNS(t,"path");return r.setAttribute("fill","currentColor"),r.setAttribute("d","M50 8H14c-3.309 0-6 2.691-6 6v36c0 3.309 2.691 6 6 6h36c3.309 0 6-2.691 6-6V14c0-3.309-2.691-6-6-6zM12 50V14c0-1.103.897-2 2-2h8v40h-8c-1.103 0-2-.897-2-2zm40 0c0 1.103-.897 2-2 2H26V12h24c1.103 0 2 .897 2 2z"),s.appendChild(r),s}function Zt(e){const t="http://www.w3.org/2000/svg",s=document.createElementNS(t,"svg");s.setAttribute("class",`${e}-footer-icon-arrow-left`),s.setAttribute("viewBox","0 0 500 500");const r=document.createElementNS(t,"path");return r.setAttribute("fill","currentColor"),r.setAttribute("d","M177.81 249.959L337.473 90.295c2.722-2.865 2.651-7.378-.143-10.1-2.793-2.65-7.163-2.65-9.956 0l-164.75 164.75c-2.793 2.793-2.793 7.306 0 10.1l164.75 164.75c2.865 2.722 7.378 2.65 10.099-.143 2.651-2.794 2.651-7.163 0-9.957L177.809 249.959z"),s.appendChild(r),s}function es(e){const t="http://www.w3.org/2000/svg",s=document.createElementNS(t,"svg");s.setAttribute("class",`${e}-footer-icon-arrow-right`),s.setAttribute("viewBox","0 0 500 500");const r=document.createElementNS(t,"path");return r.setAttribute("fill","currentColor"),r.setAttribute("d","M322.19 250.041L162.527 409.705c-2.722 2.865-2.651 7.378.143 10.1 2.793 2.65 7.163 2.65 9.956 0l164.75-164.75c2.793-2.793 2.793-7.306 0-10.1l-164.75-164.75c-2.865-2.722-7.378-2.65-10.099.143-2.651 2.794-2.651 7.163 0 9.957l159.664 159.736z"),s.appendChild(r),s}function ts(e){const t="http://www.w3.org/2000/svg",s=document.createElementNS(t,"svg");s.setAttribute("class",`${e}-footer-icon-play`),s.setAttribute("viewBox","0 0 500 500");const r=document.createElementNS(t,"path");return r.setAttribute("fill","currentColor"),r.setAttribute("d","M418.158 257.419L174.663 413.33c-6.017 3.919-15.708 3.772-21.291-.29-2.791-2.018-4.295-4.483-4.295-7.084V94.109c0-5.65 6.883-10.289 15.271-10.289 4.298 0 8.391 1.307 11.181 3.332l242.629 155.484c6.016 3.917 6.451 10.292.649 14.491-.216.154-.432.154-.649.292zM170.621 391.288l223.116-141.301L170.71 107.753l-.089 283.535z"),s.appendChild(r),s}function ss(e){const t="http://www.w3.org/2000/svg",s=document.createElementNS(t,"svg");s.setAttribute("class",`${e}-footer-icon-pause`),s.setAttribute("viewBox","0 0 500 500");const r=document.createElementNS(t,"path");return r.setAttribute("fill","currentColor"),r.setAttribute("d","M312.491 78.261c0-6.159 4.893-11.213 11.04-11.213 6.158 0 11.211 5.054 11.211 11.213v343.478c0 6.159-5.053 11.213-11.211 11.213-6.147 0-11.04-5.054-11.04-11.213V78.261zM165.257 78.261c0-6.159 4.893-11.213 11.04-11.213 6.158 0 11.211 5.054 11.211 11.213v343.478c0 6.159-5.053 11.213-11.211 11.213-6.147 0-11.04-5.054-11.04-11.213V78.261z"),s.appendChild(r),s}class rs{constructor({namespace:t,pages$:s,sideEffect:r,readonly$:i,events:a,playable:n,wrapClassName:c,pagesIndex$:l,root:o}){this.namespace=t,this.pages$=s,this.sideEffect=r,this.readonly$=i,this.events=a,this.wrapClassName=c,this.pagesIndex$=l,this.playable=n,this.$footer=this.render(),o.appendChild(this.$footer)}destroy(){this.$footer.remove()}render(){const t=document.createElement("div");t.className=this.wrapClassName("footer"),this.sideEffect.addDisposer(this.readonly$.subscribe(o=>t.classList.toggle(this.wrapClassName("readonly"),o)));const s=this.renderFooterBtn("btn-sidebar",Qt(this.namespace));this.sideEffect.addEventListener(s,"click",()=>{this.readonly$.value||this.events.emit("togglePreview")}),t.appendChild(s),this.sideEffect.addDisposer(this.pages$.subscribe(o=>{const d=o.some(p=>p.thumbnail||!p.src.startsWith("ppt"));s.style.display=d?"":"none"}));const r=document.createElement("div");r.className=this.wrapClassName("page-jumps");const i=this.renderFooterBtn("btn-page-back",Zt(this.namespace));if(this.sideEffect.addEventListener(i,"click",()=>{this.readonly$.value||this.events.emit("back")}),r.appendChild(i),this.playable){const o=this.renderFooterBtn("btn-page-play",ts(this.namespace),ss(this.namespace));this.sideEffect.addEventListener(o,"click",()=>{this.readonly$.value||(o.classList.toggle(this.wrapClassName("footer-btn-playing"),!0),this.events.emit("play"),this.sideEffect.setTimeout(()=>o.classList.toggle(this.wrapClassName("footer-btn-playing"),!1),500,"returnPlay"))}),r.appendChild(o)}const a=this.renderFooterBtn("btn-page-next",es(this.namespace));this.sideEffect.addEventListener(a,"click",()=>{this.readonly$.value||this.events.emit("next")}),r.appendChild(a);const n=document.createElement("div");n.className=this.wrapClassName("page-number");const c=document.createElement("input");c.className=this.wrapClassName("page-number-input"),this.sideEffect.addDisposer(this.readonly$.subscribe(o=>c.disabled=o)),this.sideEffect.addDisposer(this.pagesIndex$.subscribe(o=>c.value=String(o+1))),this.sideEffect.addEventListener(c,"blur",()=>{c.value=String(this.pagesIndex$.value+1)}),this.sideEffect.addEventListener(c,"change",()=>{if(this.readonly$.value)return;const o=c.value?Number(c.value)-1:NaN;o>=0?this.events.emit("jumpPage",o):c.value=String(this.pagesIndex$.value+1)});const l=document.createElement("span");return this.sideEffect.addDisposer(this.pages$.subscribe(o=>{l.textContent=" / "+o.length})),n.appendChild(c),n.appendChild(l),t.appendChild(r),t.appendChild(n),t}renderFooterBtn(t,s,r){const i=document.createElement("button");return i.className=this.wrapClassName("footer-btn")+" "+this.wrapClassName(t),i.appendChild(s),r&&i.appendChild(r),i}}class is{constructor(){this.listeners=new Map,this.relayListeners=new Set}emit(t,s){var r;(r=this.listeners.get(t))==null||r.forEach(i=>i(s))}on(t,s){let r=this.listeners.get(t);return r||(r=new Set,this.listeners.set(t,r)),r.add(s),r.size===1&&this.relayListeners.forEach(i=>i.start(t)),()=>{this.off(t,s)}}off(t,s){const r=this.listeners.get(t);if(r){const i=r.delete(s);return r.size<=0&&(this.listeners.delete(t),this.relayListeners.forEach(a=>a.dispose(t))),i}return!1}clear(t){var s;t?(s=this.listeners.get(t))==null||s.clear():this.listeners.clear()}count(t){var s;if(t)return((s=this.listeners.get(t))==null?void 0:s.size)||0;{let r=0;return this.listeners.forEach(i=>{r+=i.size}),r}}remit(t,s){let r;const i={start:a=>{a===t&&(r=s(this))},dispose:a=>{r&&(!a||a===t)&&r()}};return this.relayListeners.add(i),()=>{this.relayListeners.delete(i),r&&r()}}destroy(){this.clear(),this.relayListeners.forEach(t=>t.dispose()),this.relayListeners.clear()}}class Ve{constructor({readonly$:t,pagesIndex$:s,box:r,pages:i=[],playable:a}){this.wrapClassName=c=>`${this.namespace}-${c}`,this.namespace="netless-app-docs-viewer",this.sideEffect=new L,this.events=new is;const n=new S(i);He(this,{pages:n}),this.preview=new Kt({pages$:n,readonly$:t,pagesIndex$:s,root:r.$body,sideEffect:this.sideEffect,events:this.events,namespace:this.namespace,wrapClassName:this.wrapClassName}),this.footer=new rs({pages$:n,readonly$:t,playable:a,pagesIndex$:s,root:r.$footer,namespace:this.namespace,sideEffect:this.sideEffect,events:this.events,wrapClassName:this.wrapClassName})}destroy(){this.preview.destroy(),this.footer.destroy(),this.sideEffect.flushAll(),this.events.destroy()}}function $(e,t,s){return Math.min(Math.max(e,t),s)}function ce(e){return e.touches?e.touches[0]:e}function Re(e){e.stopPropagation(),e.cancelable&&e.preventDefault()}function Oe(e,t){return e.width===t.width&&e.height===t.height}class as{constructor(t){var s,r,i;this.velocity=0,this._paused=!0,this._animationFrameID=null,this._loopTimestamp=0,this.looper=a=>{var c;if(this._paused)return;let n=Math.floor((a-this._loopTimestamp)/1e3*60)+1;for(this._loopTimestamp=a;n-- >0;)this.stepper();(c=this.onStep)==null||c.call(this,this.current),this._paused?this._animationFrameID=null:this._animationFrameID=window.requestAnimationFrame(this.looper)},this.current=(s=t.start)!=null?s:0,this.target=this.current,this.stiffness=(r=t.stiffness)!=null?r:170,this.damping=(i=t.damping)!=null?i:26,this.onStep=t.onStep}get paused(){return this._paused}stepTo(t,s){var r;this._paused&&s!=null&&(this.current=s),this._paused=!1,this.target=t,(r=this.onStep)==null||r.call(this,this.current),this._loopTimestamp=Date.now(),this._animationFrameID=window.requestAnimationFrame(this.looper)}pause(){this._paused=!0,this._animationFrameID!=null&&window.cancelAnimationFrame(this._animationFrameID)}destroy(){this.pause(),this.onStep=void 0}stepper(){const t=-this.stiffness*(this.current-this.target),s=-this.damping*this.velocity,r=this.velocity+(t+s)/60,i=this.current+r/60;Math.abs(r-0)<.01&&Math.abs(i-this.target)<.01?(this.current=this.target,this.velocity=0,this._paused=!0):(this.current=i,this.velocity=r)}}class os{constructor(t,s,r,i,a,n){this.index=t,this.lastVisit=Date.now(),this.sideEffect=new L;const c=D(s,u=>u[t]||{width:0,height:0}),l=b([c,r],([u,h])=>(h.width-u.width)/2),o=b([a,n],([u,h])=>(u[t]||0)-h),d=document.createElement("div");d.className="page-renderer-page",d.dataset.index=`${t}`;const p=document.createElement("img");p.className="page-renderer-page-img",d.appendChild(p),this.sideEffect.addDisposer([b([c,i]).subscribe(([u,h])=>{d.style.width=`${u.width*h}px`,d.style.height=`${u.height*h}px`}),c.subscribe(u=>{u.thumbnail&&(d.style.backgroundImage=`url("${u.thumbnail}")`),p.width=u.width,p.height=u.height,p.src=u.src}),b([l,o,i]).subscribe(([u,h,g])=>{d.style.transform=`translate(${u*g}px, ${h*g}px)`})]),this.$page=d}destroy(){this.sideEffect.flushAll(),this.$page.remove()}}const ns=window.requestIdleCallback||(e=>window.setTimeout(e,5e3)),cs=window.cancelIdleCallback||window.clearTimeout;class ls{constructor(t,s,r,i,a){this.pages$=t,this.pagesSize$=s,this.scale$=r,this.pagesYs$=i,this.pagesScrollTop$=a,this.els=new Map,this.maxElCount=200,this.gcTimer=null,this.gc=()=>{var n;if(this.gcTimer=null,this.els.size>this.maxElCount){const c=[...this.els.values()].sort((l,o)=>o.lastVisit-l.lastVisit);for(let l=Math.floor(this.maxElCount/4);l<c.length;l++)(n=this.els.get(c[l].index))==null||n.destroy(),this.els.delete(c[l].index)}}}getEl(t){let s=this.els.get(t);return s||(s=new os(t,this.pages$,this.pagesSize$,this.scale$,this.pagesYs$,this.pagesScrollTop$),this.els.set(t,s)),s.lastVisit=Date.now(),this.els.size>this.maxElCount&&this.gcTimer===null&&(this.gcTimer=ns(this.gc)),s}destroy(){this.els.forEach(t=>t.destroy()),this.els.clear(),this.gcTimer!==null&&(cs(this.gcTimer),this.gcTimer=null)}}class ds{constructor({pagesScrollTop$:t,containerRect$:s,pages$:r,pagesSize$:i}){this.sideEffect=new L,r=D(r,h=>h.map(g=>{if(g.thumbnail)return g;try{const f=new URL(g.src);return f.searchParams.set("x-oss-process","image/resize,l_50"),{...g,thumbnail:f.toString()}}catch(f){return console.error(f),g}}));const a=D(r,h=>{const g=Array(h.length);for(let f=0;f<h.length;f++)g[f]=f>0?g[f-1]+h[f-1].height:0;return g}),n=D(r,h=>{let g=1/0;for(let f=h.length-1;f>=0;f--)h[f].height<=g&&(g=h[f].height);return g}),c=b([t,a,r],([h,g,f])=>{for(let v=0;v<g.length;v++)if(g[v]+f[v].height-h>=.001)return v;return g.length-1}),l=b([s,i],([h,g])=>h.width/g.width||1),o=b([r,s,n,l],([h,g,f,v])=>$(Math.ceil(g.height/v/f/2),1,h.length));Be(this,{pagesScrollTop:t,containerRect:s,pages:r,pagesSize:i,pagesIndex:c,pagesYs:a,pagesMinHeight:n,scale:l}),this.pageElManager=new ls(r,i,l,a,t),this.$pages=this.renderPages();const d=new S(!1);this.sideEffect.addDisposer(d.subscribe(h=>this.$pages.classList.toggle("is-hwa",h)));const p=()=>d.setValue(!1),u=()=>{this.sideEffect.setTimeout(p,1e3,"turn-off-hwa"),d.setValue(!0)};this.sideEffect.addDisposer(b([c,o,r]).subscribe(([h,g,f])=>{u();const v=Math.max(h-g,0),te=Math.min(h+g,f.length-1);for(let y=0;y<this.$pages.children.length;y++){const A=this.$pages.children[y],se=Number(A.dataset.index);se>=v&&se<=te||(A.remove(),y--)}for(let y=v;y<=te;y++){const A=this.pageElManager.getEl(y);A.$page.parentElement!==this.$pages&&this.$pages.appendChild(A.$page)}}))}renderPages(){const t=document.createElement("div");return t.className="page-renderer-pages-container",this.sideEffect.addDisposer(this._containerRect$.subscribe(s=>{t.style.width=`${s.width}px`,t.style.height=`${s.height}px`}),"render-pages-size"),t}destroy(){this.sideEffect.flushAll(),this.$pages.remove(),this.pageElManager.destroy()}}const hs=30;class ps{constructor({pagesScrollTop$:t,containerRect$:s,stageRect$:r,pagesSize$:i,readonly$:a,scrollbarMinHeight:n=hs,wrapClassName:c,onDragScroll:l}){this.sideEffect=new L,this.scrolling$=new S(!1),this.pagesScrollTop$=t,this.containerRect$=s,this.stageRect$=r,this.pagesSize$=i,this.scrollbarMinHeight=n,this.readonly$=a,this.wrapClassName=c,this.onDragScroll=l,this.scrollbarHeight$=b([s,r,i],([o,d,p])=>$(d.height/(d.width/p.width*p.height)*o.height,n,o.height)),this.scrollTop$=b([s,r,i,this.scrollbarHeight$,this.pagesScrollTop$],([o,d,p,u,h])=>$(h/(p.height-p.width/d.width*d.height)*(o.height-u),0,o.height-u)),this.$scrollbar=this.renderScrollbar()}mount(t){t.appendChild(this.$scrollbar)}destroy(){this.$scrollbar.remove(),this.onDragScroll=void 0,this.sideEffect.flushAll()}renderScrollbar(){const t=document.createElement("button");t.className=this.wrapClassName("scrollbar"),t.style.minHeight=`${this.scrollbarMinHeight}px`,this.sideEffect.addDisposer([this.scrollbarHeight$.subscribe(r=>{t.style.height=`${r}px`}),this.scrollTop$.subscribe(r=>{this.scrolling$.setValue(!0),this.sideEffect.setTimeout(()=>this.scrolling$.setValue(!1),100,"reset-scrolling");const i=()=>t.style.transform=`translateY(${r}px)`;window.requestAnimationFrame?window.requestAnimationFrame(i):i()}),this.scrolling$.subscribe(r=>{t.classList.toggle(this.wrapClassName("scrolling"),r)})]);const s=r=>{if(!r.isPrimary||this.readonly$.value||r.button!=null&&r.button!==0)return;Re(r);const i=this.wrapClassName("scrollbar-dragging");t.classList.toggle(i,!0);const a=this.pagesScrollTop$.value,{clientY:n}=ce(r),c=o=>{if(!o.isPrimary||this.readonly$.value)return;const{clientY:d}=ce(o),p=d-n;Math.abs(p)>0&&this.onDragScroll&&this.onDragScroll(a+p/this.containerRect$.value.height*this.pagesSize$.value.height)},l=o=>{!o.isPrimary||(t.classList.toggle(i,!1),window.removeEventListener("pointermove",c,!0),window.removeEventListener("pointerup",l,!0),window.removeEventListener("pointercancel",l,!0))};window.addEventListener("pointermove",c,!0),window.addEventListener("pointerup",l,!0),window.addEventListener("pointercancel",l,!0)};return this.sideEffect.addEventListener(t,"pointerdown",s),t}}class us{constructor({whiteboard:t,readonly$:s,box:r,pages:i,pagesScrollTop:a=0,onUserScroll:n}){this.sideEffect=new L,this.userScrolling=!1,this.whiteboard=t,this.readonly$=s,this.box=r,this.pages=i,this.onUserScroll=n;const c=()=>{var o;this.userScrolling=!1,(o=this.onUserScroll)==null||o.call(this,this.pagesScrollTop$.value)};this.debounceOnUserScroll=()=>{this.userScrolling=!0,this.sideEffect.setTimeout(c,80,"debounceOnUserScroll")};const l=new S(i);this.pagesScrollTop$=new S(a),this.pagesSize$=D(l,o=>{let d=0,p=0;for(let u=o.length-1;u>=0;u--){const h=o[u];h.width>d&&(d=h.width),p+=h.height}return{width:Math.max(1,d),height:Math.max(1,p)}},{compare:Oe}),this.pageRenderer=new ds({pagesScrollTop$:this.pagesScrollTop$,containerRect$:r._stageRect$,pages$:l,pagesSize$:this.pagesSize$}),this.viewer=new Ve({readonly$:s,pagesIndex$:this.pageRenderer._pagesIndex$,box:r,pages:i,playable:!1}),this.sideEffect.addDisposer([this.viewer.events.on("next",()=>{this.userScrollByPercent(.8)}),this.viewer.events.on("back",()=>{this.userScrollByPercent(-.8)})]),this.scrollbar=new ps({pagesScrollTop$:this.pagesScrollTop$,containerRect$:r._bodyRect$,stageRect$:r._stageRect$,pagesSize$:this.pagesSize$,readonly$:s,wrapClassName:this.wrapClassName.bind(this),onDragScroll:o=>{this.pageScrollTo(o),this.debounceOnUserScroll()}}),this.pageScrollStepper=new as({start:this.pagesScrollTop$.value,onStep:o=>{this.pageScrollTo(o)}}),this.sideEffect.addDisposer(this.viewer.events.on("jumpPage",o=>this.userScrollToPageIndex(o))),this.render(),this.setupScrollListener(),this.sideEffect.setTimeout(()=>{this.userScrolling||this.pageScrollTo(this.pageRenderer.pagesScrollTop)},100)}get pagesScrollTop(){return this.pagesScrollTop$.value}destroy(){this.sideEffect.flushAll(),this.pageScrollStepper.destroy(),this.onUserScroll=void 0,this.viewer.destroy(),this.pageRenderer.destroy(),this.scrollbar.destroy()}syncPageScrollTop(t){!this.userScrolling&&t>=0&&Math.abs(this.pagesScrollTop$.value-t)>.01&&this.pageScrollStepper.stepTo(t,this.pagesScrollTop$.value)}render(){this.box.$content.style.overflow="hidden",this.box.mountStage(this.pageRenderer.$pages),this.scrollbar.mount(this.box.$body)}pageScrollTo(t){const s=this.whiteboard.view.size.height/2/this.pageRenderer.scale;this.whiteboard.view.moveCamera({centerY:$(t+s,s,this.pagesSize$.value.height-s),animationMode:"immediately"})}userScrollToPageIndex(t){var s;if(t=$(t,0,this.pages.length-1),!this.readonly$.value&&!Number.isNaN(t)){const r=this.pageRenderer.pagesYs[t];r>=0&&((s=this.onUserScroll)==null||s.call(this,r+5/this.pageRenderer.scale))}}userScrollByPercent(t){var s;this.readonly$.value||(s=this.onUserScroll)==null||s.call(this,$(this.pageRenderer.pagesScrollTop+this.pageRenderer.containerRect.height/this.pageRenderer.scale*$(t,-1,1),0,this.pageRenderer.pagesSize.height-this.pageRenderer.containerRect.height/this.pageRenderer.scale))}setupScrollListener(){this.sideEffect.addEventListener(this.box.$main,"wheel",t=>{Re(t),!this.readonly$.value&&this.pageScrollStepper.paused&&(this.pageScrollTo(this.pagesScrollTop+t.deltaY),this.debounceOnUserScroll())},{passive:!1}),this.sideEffect.addEventListener(this.box.$main,"touchmove",t=>{!this.readonly$.value&&t.touches.length>1&&this.debounceOnUserScroll()},{passive:!0,capture:!0}),this.sideEffect.add(()=>{const t=s=>{const{width:r,height:i}=this.whiteboard.view.size;if(r<=0||i<=0)return;const a=s.centerY-this.pageRenderer.containerRect.height/this.pageRenderer.scale/2;this.pagesScrollTop$.setValue(a)};return this.whiteboard.view.callbacks.on("onCameraUpdated",t),()=>this.whiteboard.view.callbacks.off("onCameraUpdated",t)}),this.sideEffect.addDisposer(this.box._stageRect$.subscribe(t=>{const{width:s,height:r}=this.pagesSize$.value;this.whiteboard.view.moveCameraToContain({originX:0,originY:this.pageRenderer.pagesScrollTop,width:s,height:t.height/this.pageRenderer.scale,animationMode:"immediately"}),this.whiteboard.view.setCameraBound({damping:1,maxContentMode:()=>this.pageRenderer.scale,minContentMode:()=>this.pageRenderer.scale,centerX:s/2,centerY:r/2,width:s,height:r})}),"whiteboard-size-update"),this.sideEffect.addEventListener(window,"keyup",t=>{if(!(this.readonly$.value||!this.box.focus||this.box.minimized))switch(t.key){case"PageDown":{this.userScrollByPercent(.8);break}case"PageUp":{this.userScrollByPercent(-.8);break}case"ArrowLeft":{this.userScrollByPercent(-.25);break}case"ArrowRight":{this.userScrollByPercent(.25);break}case"ArrowDown":{this.userScrollByPercent(.5);break}case"ArrowUp":{this.userScrollByPercent(-.5);break}}},{capture:!0})}wrapClassName(t){return"netless-app-docs-viewer-static-"+t}}class gs{constructor({readonly$:t,context:s,whiteboard:r,box:i,pages:a}){this.sideEffect=new L,this.context=s,this.whiteboard=r,this.box=i,this.pages=a;const n=new S(s.displayer.state.sceneState.index||0);this.pagesIndex$=n,this.sideEffect.add(()=>{const c=l=>{this.jumpToPage(l.index)};return this.context.emitter.on("sceneStateChange",c),()=>this.context.emitter.off("sceneStateChange",c)}),this.viewer=new Ve({readonly$:t,pagesIndex$:n,box:i,pages:a,playable:!0}),this.sideEffect.addDisposer([this.viewer.events.on("jumpPage",c=>this.jumpToPage(c,!0)),this.viewer.events.on("play",()=>{var c;return(c=this.context.room)==null?void 0:c.pptNextStep()}),this.viewer.events.on("back",()=>this.prevPage()),this.viewer.events.on("next",()=>this.nextPage())]),this.render(),this.sideEffect.addDisposer(n.subscribe((c,l)=>{var p,u;if(t.value)return;const o=this.context.getInitScenePath(),d=(u=(p=this.context.getScenes())==null?void 0:p[c])==null?void 0:u.name;if(o&&d&&this.context.setScenePath(`${o}/${d}`),l){const h=this.context.room;if(h){const g=h.state.globalState.__pptState;h.setGlobalState({__pptState:g&&{uuid:g.uuid,pageIndex:c,disableAutoPlay:g.disableAutoPlay}})}}}))}destroy(){this.sideEffect.flushAll(),this.viewer.destroy()}nextPage(){this.jumpToPage(this.pagesIndex$.value+1,!0)}prevPage(){this.jumpToPage(this.pagesIndex$.value-1,!0)}jumpToPage(t,s=!1){this.pagesIndex$.setValue($(t,0,this.pages.length-1),s)}render(){var s;this.box.mountStage(document.createElement("div")),this.sideEffect.addEventListener(window,"keydown",r=>{var i;if(this.box.focus)switch(r.key){case"ArrowUp":case"ArrowLeft":{this.prevPage();break}case"ArrowRight":case"ArrowDown":{(i=this.context.room)==null||i.pptNextStep();break}}});const t=(s=this.whiteboard.view.divElement)==null?void 0:s.parentElement;t&&this.sideEffect.addEventListener(t,"click",r=>{var a;const i=this.context.room;if(i&&i.state.memberState.currentApplianceName==="clicker"){for(let n=r.target;n;n=n.parentElement)if((a=n.classList)!=null&&a.contains("ppt-event-source"))return;i.pptNextStep()}})}wrapClassName(t){return"netless-app-docs-viewer-dynamic-"+t}}const ms={kind:Fe,setup(e){const t=e.box,s=e.getScenes();if(!s)throw new Error("[Docs Viewer]: scenes not found.");const r=new L,i=s.map(({ppt:n})=>n?{width:n.width,height:n.height,src:n.src,thumbnail:n.previewURL}:null).filter(n=>Boolean(n));if(i.length<=0)throw new Error("[Docs Viewer]: empty scenes.");t.mountStyles(Ue);const a=new S(!e.isWritable);r.addDisposer(e.emitter.on("writableChange",n=>{a.setValue(!n)})),i[0].src.startsWith("ppt")?ws(r,e,t,i,a):fs(r,e,t,i,a),r.addDisposer(e.emitter.on("destroy",()=>{r.flushAll()}))}};function fs(e,t,s,r,i){const a=t.createWhiteBoardView({syncCamera:!1});e.addDisposer(i.subscribe(l=>{a.view.disableCameraTransform=l}));const n=t.createStorage("static-docs-viewer",{pagesScrollTop:0}),c=new us({whiteboard:a,readonly$:i,box:s,pages:r,pagesScrollTop:n.state.pagesScrollTop,onUserScroll:l=>{t.isWritable&&n.setState({pagesScrollTop:l})}});e.addDisposer(()=>c.destroy()),e.addDisposer(n.addStateChangedListener(l=>{l.pagesScrollTop&&c.syncPageScrollTop(l.pagesScrollTop.newValue||0)})),e.addDisposer(b([s._maximized$,s._managerStageRect$,s._intrinsicSize$,c.pagesSize$,c.pageRenderer._pagesMinHeight$],([l,o,d,p,u])=>l?Math.max(u/p.width*(2/5),o.height/o.width):d.height/d.width*(o.height/o.width)).subscribe(l=>{s.setStageRatio(l)}))}function ws(e,t,s,r,i){const a=t.createWhiteBoardView();a.view.disableCameraTransform=!0;const n=new gs({context:t,whiteboard:a,box:s,pages:r,readonly$:i});e.addDisposer(()=>n.destroy());const c=new S({width:r[0].width,height:r[0].height},{compare:Oe});if(e.addDisposer(n.pagesIndex$.subscribe(l=>{const o=r[l];o&&c.setValue({width:o.width,height:o.height})})),e.addDisposer(c.subscribe(l=>{i.value||a.setBaseRect(l)})),t.isAddApp){const l=e.add(()=>{const o=({width:d,height:p})=>{if(r.length>0&&s.state!=="maximized"){const{width:u,height:h}=r[0],f=h/u*d-p;f!==0&&t.isWritable&&t.emitter.emit("setBoxSize",{width:s.intrinsicWidth,height:s.intrinsicHeight+f/s.rootRect.height})}e.remove(l)};return a.view.callbacks.once("onSizeUpdated",o),()=>a.view.callbacks.off("onSizeUpdated",o)})}}export{ms as default};
