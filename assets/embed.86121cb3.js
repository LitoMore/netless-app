import"./modulepreload-polyfill.b7f2da20.js";var X=Object.defineProperty,H=(h,e,s)=>e in h?X(h,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):h[e]=s,N=(h,e,s)=>(H(h,typeof e!="symbol"?e+"":e,s),s);const U="!#%()*+,-./:;=?@[]^_`{|}~ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",J=U.length,W=Array(20),Q=()=>{for(let h=0;h<20;h++)W[h]=U.charAt(Math.random()*J);return W.join("")};function $(h){try{return h()}catch(e){console.error(e)}}class Y{constructor(){this.disposers=new Map}addDisposer(e,s=this.genUID()){return this.flush(s),this.disposers.set(s,Array.isArray(e)?()=>e.forEach($):e),s}add(e,s=this.genUID()){const a=e();return a?this.addDisposer(a,s):s}addEventListener(e,s,a,i,u=this.genUID()){return e.addEventListener(s,a,i),this.addDisposer(()=>e.removeEventListener(s,a,i),u),u}setTimeout(e,s,a=this.genUID()){const i=window.setTimeout(()=>{this.remove(a),e()},s);return this.addDisposer(()=>window.clearTimeout(i),a)}setInterval(e,s,a=this.genUID()){const i=window.setInterval(e,s);return this.addDisposer(()=>window.clearInterval(i),a)}remove(e){const s=this.disposers.get(e);return this.disposers.delete(e),s}flush(e){const s=this.remove(e);if(s)try{s()}catch(a){console.error(a)}}flushAll(){this.disposers.forEach($),this.disposers.clear()}genUID(){let e;do e=Q();while(this.disposers.has(e));return e}}var Z=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},x={exports:{}};(function(h,e){(function(s,a){{var i=a();h&&h.exports&&(e=h.exports=i),e.randomColor=i}})(Z,function(){var s=null,a={};K();var i=[],u=function(t){if(t=t||{},t.seed!==void 0&&t.seed!==null&&t.seed===parseInt(t.seed,10))s=t.seed;else if(typeof t.seed=="string")s=q(t.seed);else{if(t.seed!==void 0&&t.seed!==null)throw new TypeError("The seed value must be an integer or string");s=null}var n,r,o;if(t.count!==null&&t.count!==void 0){for(var l=t.count,g=[],f=0;f<t.count;f++)i.push(!1);for(t.count=null;l>g.length;){var M=u(t);s!==null&&(t.seed=s),g.push(M)}return t.count=l,g}return n=d(t),r=c(n,t),o=p(n,r,t),m([n,r,o],t)};function d(t){if(i.length>0){var n=z(t.hue),r=E(n),o=(n[1]-n[0])/i.length,l=parseInt((r-n[0])/o);i[l]===!0?l=(l+2)%i.length:i[l]=!0;var g=(n[0]+l*o)%359,f=(n[0]+(l+1)*o)%359;return n=[g,f],r=E(n),r<0&&(r=360+r),r}else{var n=B(t.hue);return r=E(n),r<0&&(r=360+r),r}}function c(t,n){if(n.hue==="monochrome")return 0;if(n.luminosity==="random")return E([0,100]);var r=F(t),o=r[0],l=r[1];switch(n.luminosity){case"bright":o=55;break;case"dark":o=l-10;break;case"light":l=55;break}return E([o,l])}function p(t,n,r){var o=w(t,n),l=100;switch(r.luminosity){case"dark":l=o+20;break;case"light":o=(l+o)/2;break;case"random":o=0,l=100;break}return E([o,l])}function m(t,n){switch(n.format){case"hsvArray":return t;case"hslArray":return T(t);case"hsl":var r=T(t);return"hsl("+r[0]+", "+r[1]+"%, "+r[2]+"%)";case"hsla":var o=T(t),f=n.alpha||Math.random();return"hsla("+o[0]+", "+o[1]+"%, "+o[2]+"%, "+f+")";case"rgbArray":return D(t);case"rgb":var l=D(t);return"rgb("+l.join(", ")+")";case"rgba":var g=D(t),f=n.alpha||Math.random();return"rgba("+g.join(", ")+", "+f+")";default:return O(t)}}function w(t,n){for(var r=R(t).lowerBounds,o=0;o<r.length-1;o++){var l=r[o][0],g=r[o][1],f=r[o+1][0],M=r[o+1][1];if(n>=l&&n<=f){var A=(M-g)/(f-l),v=g-A*l;return A*n+v}}return 0}function B(t){if(typeof parseInt(t)=="number"){var n=parseInt(t);if(n<360&&n>0)return[n,n]}if(typeof t=="string"){if(a[t]){var r=a[t];if(r.hueRange)return r.hueRange}else if(t.match(/^#?([0-9A-F]{3}|[0-9A-F]{6})$/i)){var o=V(t)[0];return[o,o]}}return[0,360]}function F(t){return R(t).saturationRange}function R(t){t>=334&&t<=360&&(t-=360);for(var n in a){var r=a[n];if(r.hueRange&&t>=r.hueRange[0]&&t<=r.hueRange[1])return a[n]}return"Color not found"}function E(t){if(s===null){var n=.618033988749895,r=Math.random();return r+=n,r%=1,Math.floor(t[0]+r*(t[1]+1-t[0]))}else{var o=t[1]||1,l=t[0]||0;s=(s*9301+49297)%233280;var g=s/233280;return Math.floor(l+g*(o-l))}}function O(t){var n=D(t);function r(l){var g=l.toString(16);return g.length==1?"0"+g:g}var o="#"+r(n[0])+r(n[1])+r(n[2]);return o}function y(t,n,r){var o=r[0][0],l=r[r.length-1][0],g=r[r.length-1][1],f=r[0][1];a[t]={hueRange:n,lowerBounds:r,saturationRange:[o,l],brightnessRange:[g,f]}}function K(){y("monochrome",null,[[0,0],[100,0]]),y("red",[-26,18],[[20,100],[30,92],[40,89],[50,85],[60,78],[70,70],[80,60],[90,55],[100,50]]),y("orange",[18,46],[[20,100],[30,93],[40,88],[50,86],[60,85],[70,70],[100,70]]),y("yellow",[46,62],[[25,100],[40,94],[50,89],[60,86],[70,84],[80,82],[90,80],[100,75]]),y("green",[62,178],[[30,100],[40,90],[50,85],[60,81],[70,74],[80,64],[90,50],[100,40]]),y("blue",[178,257],[[20,100],[30,86],[40,80],[50,74],[60,60],[70,52],[80,44],[90,39],[100,35]]),y("purple",[257,282],[[20,100],[30,87],[40,79],[50,70],[60,65],[70,59],[80,52],[90,45],[100,42]]),y("pink",[282,334],[[20,100],[30,90],[40,86],[60,84],[80,80],[90,75],[100,73]])}function D(t){var n=t[0];n===0&&(n=1),n===360&&(n=359),n=n/360;var r=t[1]/100,o=t[2]/100,l=Math.floor(n*6),g=n*6-l,f=o*(1-r),M=o*(1-g*r),A=o*(1-(1-g)*r),v=256,S=256,k=256;switch(l){case 0:v=o,S=A,k=f;break;case 1:v=M,S=o,k=f;break;case 2:v=f,S=o,k=A;break;case 3:v=f,S=M,k=o;break;case 4:v=A,S=f,k=o;break;case 5:v=o,S=f,k=M;break}var G=[Math.floor(v*255),Math.floor(S*255),Math.floor(k*255)];return G}function V(t){t=t.replace(/^#/,""),t=t.length===3?t.replace(/(.)/g,"$1$1"):t;var n=parseInt(t.substr(0,2),16)/255,r=parseInt(t.substr(2,2),16)/255,o=parseInt(t.substr(4,2),16)/255,l=Math.max(n,r,o),g=l-Math.min(n,r,o),f=l?g/l:0;switch(l){case n:return[60*((r-o)/g%6)||0,f,l];case r:return[60*((o-n)/g+2)||0,f,l];case o:return[60*((n-r)/g+4)||0,f,l]}}function T(t){var n=t[0],r=t[1]/100,o=t[2]/100,l=(2-r)*o;return[n,Math.round(r*o/(l<1?l:2-l)*1e4)/100,l/2*100]}function q(t){for(var n=0,r=0;r!==t.length&&!(n>=Number.MAX_SAFE_INTEGER);r++)n+=t.charCodeAt(r);return n}function z(t){if(isNaN(t)){if(typeof t=="string"){if(a[t]){var n=a[t];if(n.hueRange)return n.hueRange}else if(t.match(/^#?([0-9A-F]{3}|[0-9A-F]{6})$/i)){var r=V(t)[0];return R(r).hueRange}}}else{var o=parseInt(t);if(o<360&&o>0)return R(t).hueRange}return[0,360]}return u})})(x,x.exports);const ee=x.exports;class te{constructor(e="NetlessApp",s="error"){N(this,"kind"),N(this,"debug"),N(this,"color",ee({luminosity:"dark"})),this.kind=e,this.debug=s}log(...e){if(this.debug===!0||this.debug==="log")return this._log("log",e)}warn(...e){if(this.debug&&this.debug!=="error")return this._log("warn",e)}error(...e){if(this.debug)return this._log("error",e)}_log(e,s){console[e](`%c[${this.kind}]:`,`color: ${this.color}; font-weight: bold;`,...s)}}class I{constructor(){this.listeners=new Set}get length(){return this.listeners.size}dispatch(e){this.listeners.forEach(s=>s(e))}addListener(e){this.listeners.add(e)}removeListener(e){this.listeners.delete(e)}}const P=(h,e)=>Object.prototype.hasOwnProperty.call(h,e),L=Object.keys;function b(h){return typeof h=="object"&&h!==null}const se=b;function j(h){return Boolean(b(h)&&h.__isRef)}function re(h){return{k:ae(),v:h,__isRef:!0}}function ae(){return Date.now().toString().slice(6)+Math.random().toString().slice(2,8)}class ne{constructor({id:e,state:s,onSetState:a,getIsWritable:i,logger:u=console}){this.onStateChanged=new I,this._destroyed=!1,this.onDestroyed=new I,this._kMap=new WeakMap,this._lastValue=new Map,this.id=e,this._onSetState=a,this.getIsWritable=i,this._logger=u,this._state={},s&&L(s).forEach(d=>{const c=s[d];if(j(c)){const{k:p,v:m}=c;this._state[d]=m,b(m)&&this._kMap.set(m,p)}else this._state[d]=c})}get state(){return this._state}ensureState(e){return this.setState(L(e).reduce((s,a)=>(P(this._state,a)||(s[a]=e[a]),s),{}))}setState(e){if(this._destroyed){this._logger.error(`Cannot call setState on Store ${this.id} which is destroyed.`);return}if(!this.getIsWritable()){this._logger.error(`Cannot setState on store ${this.id} without writable access`,e);return}const s=L(e);if(s.length>0){const a={};s.forEach(i=>{const u=e[i];if(u===void 0)this._lastValue.set(i,this._state[i]),delete this._state[i],a[i]=u;else if(u!==this._state[i])if(this._lastValue.set(i,this._state[i]),this._state[i]=u,b(u)){const d=re(u);this._kMap.set(d.v,d.k),a[i]=d}else a[i]=u}),Object.keys(a).length>0&&this._onSetState(a)}}get destroyed(){return this._destroyed}_destroy(){this._destroyed=!0,this.onDestroyed.dispatch()}_updateProperties(e){if(this._destroyed){this._logger.error(`Cannot call _updateProperties on Store ${this.id} which is destroyed.`);return}if(e.length>0){const s={};e.forEach(({key:a,value:i,kind:u})=>{let d;switch(this._lastValue.has(a)&&(d=this._lastValue.get(a),this._lastValue.delete(a)),u){case 2:{P(this._state,a)&&(d=this._state[a],delete this._state[a]),s[a]={oldValue:d};break}default:{let c=i;if(j(i)){const{k:p,v:m}=i,w=this._state[a];b(w)&&this._kMap.get(w)===p?c=w:(c=m,b(m)&&this._kMap.set(m,p))}c!==this._state[a]&&(d=this._state[a],this._state[a]=c),s[a]={newValue:c,oldValue:d};break}}}),this.onStateChanged.dispatch(s)}}}class oe{constructor(e,s,a,i,u,d){this.onRoomMembersChanged=new I,this.onMessage=new I,this.onWritableChanged=new I,this.onPageChanged=new I,this._stores=new Map,this._sideEffect=new Y,this.appId=e.appId,this.debug=a,this._postMessage=i,this._mainStoreId=e.mainStoreId,this._storeRawData=e.store||{[this._mainStoreId]:{}},this._writable=e.writable,this._page=e.page,this._meta=e.meta,this._roomMembers=e.roomMembers,this._logger=d,this._sideEffect.add(()=>u(c=>{const{NEAType:p,payload:m}=c;if(p){const w=`_handleMsg${p}`;this[w]&&this[w](m)}})),this._mainStore=this.connectStore(e.mainStoreId,s),this.onStateChanged=this._mainStore.onStateChanged}get meta(){return this._meta}get roomMembers(){return this._roomMembers}_handleMsgRoomMembersChanged(e){if(e==null||Array.isArray(e)){const s=this._roomMembers;this._roomMembers=e,this.onRoomMembersChanged.dispatch({newValue:this._roomMembers,oldValue:s})}}moveCamera(e){this._postMessage({NEAType:"MoveCamera",payload:e})}sendMessage(e){this._postMessage({NEAType:"SendMagixMessage",payload:e})}_handleMsgReceiveMagixMessage(e){this.onMessage.dispatch(e)}get isWritable(){return this._writable}_handleMsgWritableChanged(e){const s=Boolean(e),a=this._writable;s!==a&&(this._writable=s,this.onWritableChanged.dispatch({oldValue:a,newValue:s}))}get page(){return this._page}setPage(e){this._page=e,this._postMessage({NEAType:"SetPage",payload:e})}_handleMsgPageChanged(e){se(e)&&(this._page=e.newValue,this.onPageChanged.dispatch(e))}connectStore(e,s){let a=this._stores.get(e);if(!a){if(!P(this._storeRawData,e)){const i={};this._postMessage({NEAType:"SetStore",payload:{[e]:i}}),this._storeRawData[e]=i}a=new ne({id:e,state:this._storeRawData[e],logger:this._logger,getIsWritable:()=>this._writable,onSetState:i=>this._postMessage({NEAType:"SetState",payload:{storeId:e,state:i}})}),this._stores.set(e,a)}return s&&a.ensureState(s),a}isStoreConnected(e){return this._stores.has(e)}removeStore(e){if(e===this._mainStoreId){this._logger.error(`Store "${e}" is not removable.`);return}const s=this._stores.get(e);s&&(this._stores.delete(e),s._destroy()),this._storeRawData[e]&&this._postMessage({NEAType:"SetStore",payload:{[e]:void 0}})}_handleMsgStoreChanged(e){Array.isArray(e)&&e.length>0&&e.forEach(({key:s,value:a,kind:i})=>{switch(i){case 2:{delete this._storeRawData[s];const u=this._stores.get(s);u&&(this._stores.delete(s),u._destroy());break}default:{this._storeRawData[s]=a;break}}})}get state(){return this._mainStore.state}ensureState(e){return this._mainStore.ensureState(e)}setState(e){return this._mainStore.setState(e)}_handleMsgStateChanged(e){if(b(e)&&e.storeId&&Array.isArray(e.actions)&&e.actions.length>0){const{storeId:s,actions:a}=e;a.forEach(({key:u,value:d,kind:c})=>{switch(c){case 2:{const p=this._storeRawData[s];b(p)&&delete p[u];break}default:{const p=this._storeRawData[s];b(p)&&(p[u]=d);break}}});const i=this._stores.get(s);i&&i._updateProperties(a)}}destroy(){this._sideEffect.flushAll()}}let C;function ie(h={}){if(!parent)throw new Error("[EmbeddedPageSDK]: SDK is not running in a iframe.");if(C)return Promise.resolve(C);const e=new te("EmbeddedPageSDK",h.debug),s=h.postMessage||(i=>{e.log("Message to parent",i),parent.postMessage(i,"*")}),a=h.addMessageListener||((i,u)=>{const d=({data:c,source:p})=>{!parent||p!==parent||!b(c)||!c.NEAType||(e.log("Message from parent",c),i(c))};return window.addEventListener("message",d,u),()=>{window.removeEventListener("message",d,u)}});return s({NEAType:"Init"}),new Promise(i=>{const u=a(d=>{if(C){u(),i(C);return}if(d.NEAType==="Init"){u();const c=new oe(d.payload,h.ensureState||{},Boolean(P(h,"debug")?h.debug:d.payload||!1),s,a,e);C=c,i(c)}})})}const _=h=>document.querySelector(h);async function he(){const h=await ie({ensureState:{count:0}}),e=()=>{console.log("refreshCount"),_("#count").textContent=String(h.state.count)};h.onStateChanged.addListener(e),_("#count").addEventListener("click",u=>{const d=u.shiftKey?h.state.count-1:h.state.count+1;h.setState({count:d})}),_("#message-send").addEventListener("click",()=>{const{value:u}=_("#message-payload");_("#message-recv").value+="> "+u+`
`,h.sendMessage(u)});const s=u=>{console.log("receiveMessage"),_("#message-recv").value+="< "+u+`
`};h.onMessage.addListener(s),_("#page-set").addEventListener("click",()=>{h.setPage(_("#page").value)});const a=()=>{console.log("refreshPage"),_("#page").value=String(h.page)};h.onPageChanged.addListener(a);const i=()=>{_("#writable").textContent=String(h.isWritable)};h.onWritableChanged.addListener(i),e(),a(),i(),_("#camera-move").addEventListener("click",()=>{const u=_("#camera-x").valueAsNumber,d=_("#camera-y").valueAsNumber,c={};u&&(c.x=u),d&&(c.y=d),h.moveCamera(c)}),window.embeddedApp=h}he();
