import{o as m,A as d,B as S,C as f}from"./index.769f0428.js";import{A as P,D as R,B as $}from"./index.769f0428.js";import"./modulepreload-polyfill.b7f2da20.js";const v=void 0,D={kind:"Slide",setup(e){var a,l;if(console.log("[Slide] setup @ "+void 0),!e.storage.state.taskId)throw new Error("[Slide] no taskId");const t=e.getAppOptions()||{},r=Boolean(t.debug),n=b(e);n.info("[Slide] setup @ "+void 0);const s=new m,o=new d({interactive:!0,mode:"interactive",resize:!0,enableGlobalClick:!0,controller:r,timestamp:c(e),logger:n,renderOptions:{minFPS:t.minFPS||25,maxFPS:t.maxFPS||30,autoFPS:(a=t.autoFPS)!=null?a:!0,autoResolution:(l=t.autoResolution)!=null?l:!0,resolution:t.resolution,transactionBgColor:t.bgColor||p(e.box.$content)},taskId:e.storage.state.taskId,url:e.storage.state.url});o.context=e,s.addDisposer(S.set(e.appId,o)),e.box.mountStyles(d.styles),e.box.mountStage(o.$slide),e.box.mountFooter(o.$footer),e.box.mountContent(o.$content),s.addDisposer(()=>o.destroy()),C({context:e,viewer:o,sideEffect:s,logger:n}),y(e,()=>{n.info("[Slide] destroy"),s.flushAll()})}};function I(e){const{container:t}=e;t.style.cssText="display:flex;flex-direction:column";const r=new d(e);return t.appendChild(document.createElement("style")).textContent=d.styles,t.appendChild(r.$content),t.appendChild(r.$footer),r.prepare(()=>r.slide.renderSlide(1)),r}function c(e){const t=e.room,r=e.displayer;return t?()=>t.calibrationTimestamp:r?()=>r.beginTimestamp+r.progressTime:()=>Date.now()}function b(e){return e.displayer.logger}function p(e){try{let t=window.getComputedStyle(e).backgroundColor;if(t!=="rgba(0, 0, 0, 0)"&&t!=="transparent")return t=h(t),console.log("[Slide] guess bg color:",t),t;if(e.parentElement)return p(e.parentElement)}catch{}return"#ffffff"}function h(e){const t=f.get(e);if(t&&t.model==="rgb"){const r=t.value,s=(((Math.round(r[0])&255)<<16)+((Math.round(r[1])&255)<<8)+(Math.round(r[2])&255)).toString(16);return"#"+"000000".substring(s.length)+s}else return e}function y(e,t){e.emitter.on("destroy",t)}function C({context:e,viewer:t,sideEffect:r,logger:n}){const s=n.info.bind(n);let o=null;t.prepare(({width:i,height:u,slideCount:g})=>{e.destroyed||(i&&e.box.setStageRatio(u/i),o=e.createWhiteBoardView({size:g}),l())});const{slide:a}=t;function l(){if(e.storage.state.state)s("[Slide] restore",{...e.storage.state.state}),a.setSlideState(e.storage.state.state);else if(e.isAddApp)s("[Slide] kick start"),a.renderSlide(1);else{s("[Slide] wait for restore");const i=r.add(()=>{const g=setInterval(()=>{e.storage.state.state||(s("[Slide] timeout"),a.renderSlide(1))},15e3);return()=>clearInterval(g)}),u=r.addDisposer(e.storage.addStateChangedListener(()=>{e.storage.state.state&&(s("[Slide] restore",{...e.storage.state.state}),a.setSlideState(e.storage.state.state),r.flush(u),r.flush(i))}))}}a.on("stateChange",()=>{e.isWritable&&(s("[Slide] save state",{...a.slideState}),e.storage.setState({state:a.slideState}))}),a.on("syncDispatch",i=>{e.isWritable&&(s("[Slide] dispatch",{...i}),e.dispatchMagixEvent("syncDispatch",i))}),r.addDisposer(e.addMagixEventListener("syncDispatch",({payload:i})=>{s("[Slide] receive",{...i}),a.emit("syncReceive",i)},{fireSelfEventAfterCommit:!0})),a.on("slideChange",i=>{e.isWritable&&o&&(s("[Slide] page to",i),o.jumpPage(i-1))}),t.setReadonly(!e.isWritable),r.addDisposer(e.emitter.on("writableChange",i=>{t.setReadonly(!i)}))}export{P as SlideViewer,R as addHooks,D as default,I as previewSlide,$ as refrigerator,v as version};
