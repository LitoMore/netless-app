import"./modulepreload-polyfill.b7f2da20.js";var X=Object.defineProperty,J=(h,e,r)=>e in h?X(h,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):h[e]=r,I=(h,e,r)=>(J(h,typeof e!="symbol"?e+"":e,r),r);const F="!#%()*+,-./:;=?@[]^_`{|}~ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",Q=F.length,$=Array(20),P=()=>{for(let h=0;h<20;h++)$[h]=F.charAt(Math.random()*Q);return $.join("")};class U{constructor(){this.disposers=new Map}add(e,r=P()){return this.flush(r),this.disposers.set(r,e()),r}addDisposer(e,r=P()){return this.flush(r),this.disposers.set(r,e),r}addEventListener(e,r,a,i,d=P()){return this.add(()=>(e.addEventListener(r,a,i),()=>e.removeEventListener(r,a,i)),d),d}setTimeout(e,r,a=P()){return this.add(()=>{const i=window.setTimeout(()=>{this.remove(a),e()},r);return()=>window.clearTimeout(i)},a)}setInterval(e,r,a=P()){return this.add(()=>{const i=window.setInterval(e,r);return()=>window.clearInterval(i)},a)}remove(e){const r=this.disposers.get(e);return this.disposers.delete(e),r}flush(e){const r=this.remove(e);if(r)try{r()}catch(a){console.error(a)}}flushAll(){this.disposers.forEach(e=>{try{e()}catch(r){console.error(r)}}),this.disposers.clear()}}var Y=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},D={exports:{}};(function(h,e){(function(r,a){{var i=a();h&&h.exports&&(e=h.exports=i),e.randomColor=i}})(Y,function(){var r=null,a={};j();var i=[],d=function(t){if(t=t||{},t.seed!==void 0&&t.seed!==null&&t.seed===parseInt(t.seed,10))r=t.seed;else if(typeof t.seed=="string")r=G(t.seed);else{if(t.seed!==void 0&&t.seed!==null)throw new TypeError("The seed value must be an integer or string");r=null}var n,s,o;if(t.count!==null&&t.count!==void 0){for(var l=t.count,g=[],f=0;f<t.count;f++)i.push(!1);for(t.count=null;l>g.length;){var S=d(t);r!==null&&(t.seed=r),g.push(S)}return t.count=l,g}return n=c(t),s=u(n,t),o=_(n,s,t),b([n,s,o],t)};function c(t){if(i.length>0){var n=q(t.hue),s=C(n),o=(n[1]-n[0])/i.length,l=parseInt((s-n[0])/o);i[l]===!0?l=(l+2)%i.length:i[l]=!0;var g=(n[0]+l*o)%359,f=(n[0]+(l+1)*o)%359;return n=[g,f],s=C(n),s<0&&(s=360+s),s}else{var n=B(t.hue);return s=C(n),s<0&&(s=360+s),s}}function u(t,n){if(n.hue==="monochrome")return 0;if(n.luminosity==="random")return C([0,100]);var s=H(t),o=s[0],l=s[1];switch(n.luminosity){case"bright":o=55;break;case"dark":o=l-10;break;case"light":l=55;break}return C([o,l])}function _(t,n,s){var o=M(t,n),l=100;switch(s.luminosity){case"dark":l=o+20;break;case"light":o=(l+o)/2;break;case"random":o=0,l=100;break}return C([o,l])}function b(t,n){switch(n.format){case"hsvArray":return t;case"hslArray":return x(t);case"hsl":var s=x(t);return"hsl("+s[0]+", "+s[1]+"%, "+s[2]+"%)";case"hsla":var o=x(t),f=n.alpha||Math.random();return"hsla("+o[0]+", "+o[1]+"%, "+o[2]+"%, "+f+")";case"rgbArray":return V(t);case"rgb":var l=V(t);return"rgb("+l.join(", ")+")";case"rgba":var g=V(t),f=n.alpha||Math.random();return"rgba("+g.join(", ")+", "+f+")";default:return K(t)}}function M(t,n){for(var s=L(t).lowerBounds,o=0;o<s.length-1;o++){var l=s[o][0],g=s[o][1],f=s[o+1][0],S=s[o+1][1];if(n>=l&&n<=f){var y=(S-g)/(f-l),p=g-y*l;return y*n+p}}return 0}function B(t){if(typeof parseInt(t)=="number"){var n=parseInt(t);if(n<360&&n>0)return[n,n]}if(typeof t=="string"){if(a[t]){var s=a[t];if(s.hueRange)return s.hueRange}else if(t.match(/^#?([0-9A-F]{3}|[0-9A-F]{6})$/i)){var o=W(t)[0];return[o,o]}}return[0,360]}function H(t){return L(t).saturationRange}function L(t){t>=334&&t<=360&&(t-=360);for(var n in a){var s=a[n];if(s.hueRange&&t>=s.hueRange[0]&&t<=s.hueRange[1])return a[n]}return"Color not found"}function C(t){if(r===null){var n=.618033988749895,s=Math.random();return s+=n,s%=1,Math.floor(t[0]+s*(t[1]+1-t[0]))}else{var o=t[1]||1,l=t[0]||0;r=(r*9301+49297)%233280;var g=r/233280;return Math.floor(l+g*(o-l))}}function K(t){var n=V(t);function s(l){var g=l.toString(16);return g.length==1?"0"+g:g}var o="#"+s(n[0])+s(n[1])+s(n[2]);return o}function w(t,n,s){var o=s[0][0],l=s[s.length-1][0],g=s[s.length-1][1],f=s[0][1];a[t]={hueRange:n,lowerBounds:s,saturationRange:[o,l],brightnessRange:[g,f]}}function j(){w("monochrome",null,[[0,0],[100,0]]),w("red",[-26,18],[[20,100],[30,92],[40,89],[50,85],[60,78],[70,70],[80,60],[90,55],[100,50]]),w("orange",[18,46],[[20,100],[30,93],[40,88],[50,86],[60,85],[70,70],[100,70]]),w("yellow",[46,62],[[25,100],[40,94],[50,89],[60,86],[70,84],[80,82],[90,80],[100,75]]),w("green",[62,178],[[30,100],[40,90],[50,85],[60,81],[70,74],[80,64],[90,50],[100,40]]),w("blue",[178,257],[[20,100],[30,86],[40,80],[50,74],[60,60],[70,52],[80,44],[90,39],[100,35]]),w("purple",[257,282],[[20,100],[30,87],[40,79],[50,70],[60,65],[70,59],[80,52],[90,45],[100,42]]),w("pink",[282,334],[[20,100],[30,90],[40,86],[60,84],[80,80],[90,75],[100,73]])}function V(t){var n=t[0];n===0&&(n=1),n===360&&(n=359),n=n/360;var s=t[1]/100,o=t[2]/100,l=Math.floor(n*6),g=n*6-l,f=o*(1-s),S=o*(1-g*s),y=o*(1-(1-g)*s),p=256,E=256,A=256;switch(l){case 0:p=o,E=y,A=f;break;case 1:p=S,E=o,A=f;break;case 2:p=f,E=o,A=y;break;case 3:p=f,E=S,A=o;break;case 4:p=y,E=f,A=o;break;case 5:p=o,E=f,A=S;break}var z=[Math.floor(p*255),Math.floor(E*255),Math.floor(A*255)];return z}function W(t){t=t.replace(/^#/,""),t=t.length===3?t.replace(/(.)/g,"$1$1"):t;var n=parseInt(t.substr(0,2),16)/255,s=parseInt(t.substr(2,2),16)/255,o=parseInt(t.substr(4,2),16)/255,l=Math.max(n,s,o),g=l-Math.min(n,s,o),f=l?g/l:0;switch(l){case n:return[60*((s-o)/g%6)||0,f,l];case s:return[60*((o-n)/g+2)||0,f,l];case o:return[60*((n-s)/g+4)||0,f,l]}}function x(t){var n=t[0],s=t[1]/100,o=t[2]/100,l=(2-s)*o;return[n,Math.round(s*o/(l<1?l:2-l)*1e4)/100,l/2*100]}function G(t){for(var n=0,s=0;s!==t.length&&!(n>=Number.MAX_SAFE_INTEGER);s++)n+=t.charCodeAt(s);return n}function q(t){if(isNaN(t)){if(typeof t=="string"){if(a[t]){var s=a[t];if(s.hueRange)return s.hueRange}else if(t.match(/^#?([0-9A-F]{3}|[0-9A-F]{6})$/i)){var o=W(t)[0];return L(o).hueRange}}}else{var n=parseInt(t);if(n<360&&n>0)return L(t).hueRange}return[0,360]}return d})})(D,D.exports);var Z=D.exports;class ee{constructor(e="NetlessApp",r="error"){I(this,"kind"),I(this,"debug"),I(this,"color",Z({luminosity:"dark"})),this.kind=e,this.debug=r}log(...e){if(this.debug===!0||this.debug==="log")return this._log("log",e)}warn(...e){if(this.debug&&this.debug!=="error")return this._log("warn",e)}error(...e){if(this.debug)return this._log("error",e)}_log(e,r){console[e](`%c[${this.kind}]:`,`color: ${this.color}; font-weight: bold;`,...r)}}class R{constructor(){this.listeners=new Set}get length(){return this.listeners.size}dispatch(e){this.listeners.forEach(r=>r(e))}addListener(e){this.listeners.add(e)}removeListener(e){this.listeners.delete(e)}}const N=(h,e)=>Object.prototype.hasOwnProperty.call(h,e),k=Object.keys;function v(h){return typeof h=="object"&&h!==null}const te=v;function O(h){return Boolean(v(h)&&h.__isRef)}function re(h){return{k:se(),v:h,__isRef:!0}}function se(){return Date.now().toString().slice(6)+Math.random().toString().slice(2,8)}class ae{constructor({id:e,state:r,onSetState:a,getIsWritable:i,logger:d=console}){this.onStateChanged=new R,this._destroyed=!1,this.onDestroyed=new R,this._kMap=new WeakMap,this._lastValue=new Map,this.id=e,this._onSetState=a,this.getIsWritable=i,this._logger=d,this._state={},r&&k(r).forEach(c=>{const u=r[c];if(O(u)){const{k:_,v:b}=u;this._state[c]=b,v(b)&&this._kMap.set(b,_)}else this._state[c]=u})}get state(){return this._state}ensureState(e){return this.setState(k(e).reduce((r,a)=>(N(this._state,a)||(r[a]=e[a]),r),{}))}setState(e){if(this._destroyed){this._logger.error(`Cannot call setState on Store ${this.id} which is destroyed.`);return}if(!this.getIsWritable()){this._logger.error(`Cannot setState on store ${this.id} without writable access`,e);return}const r=k(e);if(r.length>0){const a={};r.forEach(i=>{const d=e[i];if(d===void 0)this._lastValue.set(i,this._state[i]),delete this._state[i],a[i]=d;else if(d!==this._state[i])if(this._lastValue.set(i,this._state[i]),this._state[i]=d,v(d)){const c=re(d);this._kMap.set(c.v,c.k),a[i]=c}else a[i]=d}),Object.keys(a).length>0&&this._onSetState(a)}}get destroyed(){return this._destroyed}_destroy(){this._destroyed=!0,this.onDestroyed.dispatch()}_updateProperties(e){if(this._destroyed){this._logger.error(`Cannot call _updateProperties on Store ${this.id} which is destroyed.`);return}if(e.length>0){const r={};e.forEach(({key:a,value:i,kind:d})=>{let c;switch(this._lastValue.has(a)&&(c=this._lastValue.get(a),this._lastValue.delete(a)),d){case 2:{N(this._state,a)&&(c=this._state[a],delete this._state[a]),r[a]={oldValue:c};break}default:{let u=i;if(O(i)){const{k:_,v:b}=i,M=this._state[a];v(M)&&this._kMap.get(M)===_?u=M:(u=b,v(b)&&this._kMap.set(b,_))}u!==this._state[a]&&(c=this._state[a],this._state[a]=u),r[a]={newValue:u,oldValue:c};break}}}),this.onStateChanged.dispatch(r)}}}class ne{constructor(e,r,a,i,d,c){this.onRoomMembersChanged=new R,this.onMessage=new R,this.onWritableChanged=new R,this.onPageChanged=new R,this._stores=new Map,this._sideEffect=new U,this.appId=e.appId,this.debug=a,this._postMessage=i,this._mainStoreId=e.mainStoreId,this._storeRawData=e.store||{[this._mainStoreId]:{}},this._writable=e.writable,this._page=e.page,this._meta=e.meta,this._roomMembers=e.roomMembers,this._logger=c,this._sideEffect.add(()=>d(u=>{const{NEAType:_,payload:b}=u;if(_){const M=`_handleMsg${_}`;this[M]&&this[M](b)}})),this._mainStore=this.connectStore(e.mainStoreId,r),this.onStateChanged=this._mainStore.onStateChanged}get meta(){return this._meta}get roomMembers(){return this._roomMembers}_handleMsgRoomMembersChanged(e){if(e==null||Array.isArray(e)){const r=this._roomMembers;this._roomMembers=e,this.onRoomMembersChanged.dispatch({newValue:this._roomMembers,oldValue:r})}}moveCamera(e){this._postMessage({NEAType:"MoveCamera",payload:e})}sendMessage(e){this._postMessage({NEAType:"SendMagixMessage",payload:e})}_handleMsgReceiveMagixMessage(e){this.onMessage.dispatch(e)}get isWritable(){return this._writable}_handleMsgWritableChanged(e){const r=Boolean(e),a=this._writable;r!==a&&(this._writable=r,this.onWritableChanged.dispatch({oldValue:a,newValue:r}))}get page(){return this._page}setPage(e){this._page=e,this._postMessage({NEAType:"SetPage",payload:e})}_handleMsgPageChanged(e){te(e)&&(this._page=e.newValue,this.onPageChanged.dispatch(e))}connectStore(e,r){let a=this._stores.get(e);if(!a){if(!N(this._storeRawData,e)){const i={};this._postMessage({NEAType:"SetStore",payload:{[e]:i}}),this._storeRawData[e]=i}a=new ae({id:e,state:this._storeRawData[e],logger:this._logger,getIsWritable:()=>this._writable,onSetState:i=>this._postMessage({NEAType:"SetState",payload:{storeId:e,state:i}})}),this._stores.set(e,a)}return r&&a.ensureState(r),a}isStoreConnected(e){return this._stores.has(e)}removeStore(e){if(e===this._mainStoreId){this._logger.error(`Store "${e}" is not removable.`);return}const r=this._stores.get(e);r&&(this._stores.delete(e),r._destroy()),this._storeRawData[e]&&this._postMessage({NEAType:"SetStore",payload:{[e]:void 0}})}_handleMsgStoreChanged(e){Array.isArray(e)&&e.length>0&&e.forEach(({key:a,value:i,kind:d})=>{switch(d){case 2:{delete this._storeRawData[a];const c=this._stores.get(a);c&&(this._stores.delete(a),c._destroy());break}default:{this._storeRawData[a]=i;break}}})}get state(){return this._mainStore.state}ensureState(e){return this._mainStore.ensureState(e)}setState(e){return this._mainStore.setState(e)}_handleMsgStateChanged(e){if(v(e)&&e.storeId&&Array.isArray(e.actions)&&e.actions.length>0){const{storeId:r,actions:a}=e;a.forEach(({key:d,value:c,kind:u})=>{switch(u){case 2:{const _=this._storeRawData[r];v(_)&&delete _[d];break}default:{const _=this._storeRawData[r];v(_)&&(_[d]=c);break}}});const i=this._stores.get(r);i&&i._updateProperties(a)}}destroy(){this._sideEffect.flushAll()}}let T;function ie(h={}){if(!parent)throw new Error("[EmbeddedPageSDK]: SDK is not running in a iframe.");if(T)return Promise.resolve(T);const e=new ee("EmbeddedPageSDK",h.debug),r=h.postMessage||(i=>{e.log("Message to parent",i),parent.postMessage(i,"*")}),a=h.addMessageListener||((i,d)=>{const c=({data:u,source:_})=>{!parent||_!==parent||!v(u)||!u.NEAType||(e.log("Message from parent",u),i(u))};return window.addEventListener("message",c,d),()=>{window.removeEventListener("message",c,d)}});return r({NEAType:"Init"}),new Promise(i=>{const d=a(c=>{if(T){d(),i(T);return}if(c.NEAType==="Init"){d();const u=new ne(c.payload,h.ensureState||{},Boolean(N(h,"debug")?h.debug:c.payload||!1),r,a,e);T=u,i(u)}})})}const m=h=>document.querySelector(h);async function oe(){const h=await ie({ensureState:{count:0}}),e=()=>{console.log("refreshCount"),m("#count").textContent=String(h.state.count)};h.onStateChanged.addListener(e),m("#count").addEventListener("click",d=>{const c=d.shiftKey?h.state.count-1:h.state.count+1;h.setState({count:c})}),m("#message-send").addEventListener("click",()=>{const{value:d}=m("#message-payload");m("#message-recv").value+="> "+d+`
`,h.sendMessage(d)});const r=d=>{console.log("receiveMessage"),m("#message-recv").value+="< "+d+`
`};h.onMessage.addListener(r),m("#page-set").addEventListener("click",()=>{h.setPage(m("#page").value)});const a=()=>{console.log("refreshPage"),m("#page").value=String(h.page)};h.onPageChanged.addListener(a);const i=()=>{m("#writable").textContent=String(h.isWritable)};h.onWritableChanged.addListener(i),e(),a(),i(),m("#camera-move").addEventListener("click",()=>{const d=m("#camera-x").valueAsNumber,c=m("#camera-y").valueAsNumber,u=m("#camera-scale").valueAsNumber,_={};d&&(_.x=d),c&&(_.y=c),u&&(_.scale=u),h.moveCamera(_)}),window.embeddedApp=h}oe();
