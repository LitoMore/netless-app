import{S as H,i as K,s as M,e as h,b as d,d as E,f as S,g,l as G,k as V,a as A,h as O,t as I,j as F,c as q,n as D,J as N,m as Q}from"./index.b6706f12.js";import"./modulepreload-polyfill.b7f2da20.js";var W="assets/pencil.614cc8ea.svg",j="assets/pencil-off.f49ce2a4.svg",R="assets/plus.4b34cdbf.svg",U="assets/close.c4eb3b01.svg",X="assets/up.c9e084a4.svg";function z(l,t,e){const n=l.slice();return n[16]=t[e],n[17]=t,n[18]=e,n}function J(l){let t,e,n,c,p,i;return{c(){t=h("button"),e=h("img"),d(e,"draggable","false"),E(e.src,n=R)||d(e,"src",n),d(e,"alt","add"),d(t,"title","Add"),t.disabled=c=l[1].length>=20},m(s,r){S(s,t,r),g(t,e),p||(i=G(t,"click",l[7]),p=!0)},p(s,r){r&2&&c!==(c=s[1].length>=20)&&(t.disabled=c)},d(s){s&&V(t),p=!1,i()}}}function L(l){let t,e,n,c,p;return{c(){t=h("button"),e=h("img"),d(e,"draggable","false"),E(e.src,n=l[4]?j:W)||d(e,"src",n),d(e,"alt","edit"),d(t,"title","Edit")},m(i,s){S(i,t,s),g(t,e),c||(p=G(t,"click",l[5]),c=!0)},p(i,s){s&16&&!E(e.src,n=i[4]?j:W)&&d(e,"src",n)},d(i){i&&V(t),c=!1,p()}}}function P(l){let t,e,n=(l[2][l[18]]||0)+"",c,p,i,s,r,_,u,m;function k(){return l[12](l[18])}return{c(){t=h("span"),e=I("("),c=I(n),p=I(")"),i=A(),s=h("button"),r=h("img"),d(t,"class","netless-app-vote-count"),d(r,"draggable","false"),E(r.src,_=X)||d(r,"src",_),d(r,"alt","vote"),d(s,"title","Vote")},m(a,b){S(a,t,b),g(t,e),g(t,c),g(t,p),S(a,i,b),S(a,s,b),g(s,r),u||(m=G(s,"click",k),u=!0)},p(a,b){l=a,b&4&&n!==(n=(l[2][l[18]]||0)+"")&&F(c,n)},d(a){a&&V(t),a&&V(i),a&&V(s),u=!1,m()}}}function T(l){let t,e,n,c,p;function i(){return l[13](l[18])}return{c(){t=h("button"),e=h("img"),d(e,"draggable","false"),E(e.src,n=U)||d(e,"src",n),d(e,"alt","delete"),d(t,"title","Delete")},m(s,r){S(s,t,r),g(t,e),c||(p=G(t,"click",i),c=!0)},p(s,r){l=s},d(s){s&&V(t),c=!1,p()}}}function B(l){let t,e,n,c,p,i,s,r;function _(){l[11].call(e,l[17],l[18])}let u=!l[4]&&P(l),m=l[4]&&T(l);return{c(){t=h("li"),e=h("input"),c=A(),u&&u.c(),p=A(),m&&m.c(),i=A(),d(e,"class","netless-app-vote-item"),e.readOnly=n=!l[4]},m(k,a){S(k,t,a),g(t,e),O(e,l[16]),g(t,c),u&&u.m(t,null),g(t,p),m&&m.m(t,null),g(t,i),s||(r=G(e,"input",_),s=!0)},p(k,a){l=k,a&16&&n!==(n=!l[4])&&(e.readOnly=n),a&2&&e.value!==l[16]&&O(e,l[16]),l[4]?u&&(u.d(1),u=null):u?u.p(l,a):(u=P(l),u.c(),u.m(t,p)),l[4]?m?m.p(l,a):(m=T(l),m.c(),m.m(t,i)):m&&(m.d(1),m=null)},d(k){k&&V(t),u&&u.d(),m&&m.d(),s=!1,r()}}}function Y(l){let t,e,n,c,p,i,s=(l[0]||"what to eat")+"",r,_,u,m,k,a=l[4]&&J(l),b=l[3]&&L(l),y=l[1],v=[];for(let f=0;f<y.length;f+=1)v[f]=B(z(l,y,f));return{c(){t=h("div"),e=h("div"),a&&a.c(),n=A(),b&&b.c(),c=A(),p=h("div"),i=h("h2"),r=I(s),_=A(),u=h("ul");for(let f=0;f<v.length;f+=1)v[f].c();d(e,"class","netless-app-vote-controls"),d(i,"contenteditable",l[4]),q(i,"editing",l[4]),d(p,"class","netless-app-vote-title"),d(u,"class","netless-app-vote-items"),d(t,"class","netless-app-vote"),d(t,"data-kind","vote")},m(f,w){S(f,t,w),g(t,e),a&&a.m(e,null),g(e,n),b&&b.m(e,null),g(t,c),g(t,p),g(p,i),g(i,r),g(t,_),g(t,u);for(let o=0;o<v.length;o+=1)v[o].m(u,null);m||(k=G(i,"input",l[6]),m=!0)},p(f,[w]){if(f[4]?a?a.p(f,w):(a=J(f),a.c(),a.m(e,n)):a&&(a.d(1),a=null),f[3]?b?b.p(f,w):(b=L(f),b.c(),b.m(e,null)):b&&(b.d(1),b=null),w&1&&s!==(s=(f[0]||"what to eat")+"")&&F(r,s),w&16&&d(i,"contenteditable",f[4]),w&16&&q(i,"editing",f[4]),w&790){y=f[1];let o;for(o=0;o<y.length;o+=1){const C=z(f,y,o);v[o]?v[o].p(C,w):(v[o]=B(C),v[o].c(),v[o].m(u,null))}for(;o<v.length;o+=1)v[o].d(1);v.length=y.length}},i:D,o:D,d(f){f&&V(t),a&&a.d(),b&&b.d(),N(v,f),m=!1,k()}}}function Z(l,t,e){let n;const c=Q();let{writable:p=!1}=t,{title:i=""}=t,{items:s=["lorem","ipsum","dolo","sit","amet"]}=t,{votes:r=[0,0,0,0,0]}=t,_="vote";function u(){e(10,_=n?"vote":"edit"),_==="vote"&&(e(2,r=Array(s.length).fill(0)),b())}function m(o){e(0,i=o.target.textContent||"")}function k(){e(1,s=s.concat([""]))}function a(o){e(1,s=s.slice(0,o).concat(s.slice(o+1)))}function b(){p&&(r.forEach((o,C)=>{c("update",{votes:[C,o]})}),c("update",{title:i,items:s}))}function y(o){p&&c("update",{votes:[o,r[o]+1]})}function v(o,C){o[C]=this.value,e(1,s)}const f=o=>y(o),w=o=>a(o);return l.$$set=o=>{"writable"in o&&e(3,p=o.writable),"title"in o&&e(0,i=o.title),"items"in o&&e(1,s=o.items),"votes"in o&&e(2,r=o.votes)},l.$$.update=()=>{l.$$.dirty&1024&&e(4,n=_==="edit")},[i,s,r,p,n,u,m,k,a,y,_,v,f,w]}class x extends H{constructor(t){super(),K(this,t,Z,Y,M,{writable:3,title:0,items:1,votes:2})}}var $=(()=>`.netless-app-vote{width:100%;height:100%;background-color:#fff;display:flex;flex-flow:column nowrap}.netless-app-vote [contenteditable=true]{border-bottom:1px dashed #ccc}.netless-app-vote button{height:25px;gap:4px;background-color:transparent;border:2px solid transparent;border-radius:4px}.netless-app-vote button:hover{border-color:#ccc}.netless-app-vote button:active{background-color:#ccc}.netless-app-vote button img{width:16px;height:16px}.netless-app-vote-controls{position:absolute;top:8px;right:8px}.netless-app-vote-title{padding:8px}.netless-app-vote-title h2{margin:0;padding:2px 8px;display:inline-block;line-height:1.1;color:#333;border-bottom:1px dashed transparent}.netless-app-vote-items{flex-grow:1;margin:0;padding:0 8px 12px;list-style-type:none;overflow-y:auto}.netless-app-vote-items li{display:flex;align-items:center;gap:5px;line-height:1.5;padding-bottom:4px}.netless-app-vote-items li button{display:inline-block}.netless-app-vote-item{display:block;font-size:16px;line-height:1.5;font-family:Arial,sans-serif;flex-grow:1;border:1px solid #eee;border-radius:4px;padding:2px 8px}.netless-app-vote-item[readonly]{border-color:transparent}.netless-app-vote-count{padding-right:8px;font-variant-numeric:tabular-nums}.telebox-color-scheme-dark .netless-app-vote{color-scheme:dark;background-color:#121212;color:#eee}.telebox-color-scheme-dark [contenteditable=true]{border-bottom-color:#666}.telebox-color-scheme-dark button:hover{border-color:#666}.telebox-color-scheme-dark button:active{background-color:#666}.telebox-color-scheme-dark button img{filter:invert(1)}.telebox-color-scheme-dark .netless-app-vote-title h2{color:#ccc}.telebox-color-scheme-dark .netless-app-vote-item{border-color:#666}
`)();const le={kind:"Vote",setup(l){const t=l.box,e=l.createStorage("vote",{title:"",items:[]});t.mountStyles($);const n=new x({target:t.$content,props:{writable:l.isWritable,title:e.state.title,items:e.state.items,votes:e.state.items.map((i,s)=>e.state[`item-${s}`]||0)}}),c=l.emitter.on("writableChange",()=>{n.$set({writable:l.isWritable})});n.$on("update",({detail:i})=>{if("title"in i&&e.setState({title:i.title}),"items"in i&&e.setState({items:i.items}),Array.isArray(i.votes)){const[s,r]=i.votes;e.setState({[`item-${s}`]:r})}});const p=e.addStateChangedListener(i=>{if(console.log(e.state),i.title)n.$set({title:i.title.newValue});else{const s=e.state.items.map((r,_)=>e.state[`item-${_}`]||0);n.$set({items:e.state.items,votes:s})}});l.emitter.on("destroy",()=>{c(),p(),n.$destroy()})}};export{le as default};
