import{w as m,ak as d,al as S,am as f}from"./index.44dcc5d4.js";import{ak as R,an as A,al as $}from"./index.44dcc5d4.js";import"./modulepreload-polyfill.b7f2da20.js";const v=void 0,D={kind:"Slide",setup(e){var n,i;if(console.log("[Slide] setup @ "+void 0),!e.storage.state.taskId)throw new Error("[Slide] no taskId");const t=e.getAppOptions()||{},s=b(e);s.info("[Slide] setup @ "+void 0);const o=new m,r=new d({interactive:!0,mode:"interactive",resize:!0,enableGlobalClick:!0,timestamp:c(e),logger:s,renderOptions:{minFPS:t.minFPS||25,maxFPS:t.maxFPS||30,autoFPS:(n=t.autoFPS)!=null?n:!0,autoResolution:(i=t.autoResolution)!=null?i:!0,resolution:t.resolution,transactionBgColor:t.bgColor||p(e.box.$content)},taskId:e.storage.state.taskId,url:e.storage.state.url});r.context=e,o.addDisposer(S.set(e.appId,r)),e.box.mountStyles(d.styles),e.box.mountStage(r.$slide),e.box.mountFooter(r.$footer),e.box.mountContent(r.$content),o.addDisposer(()=>r.destroy()),k({context:e,viewer:r,sideEffect:o,logger:s}),y(e,()=>{s.info("[Slide] destroy"),o.flushAll()})}};function I(e){const{container:t}=e;t.style.cssText="display:flex;flex-direction:column";const s=new d(e);return t.appendChild(document.createElement("style")).textContent=d.styles,t.appendChild(s.$content),t.appendChild(s.$footer),s.prepare(()=>s.slide.renderSlide(1)),s}function c(e){const t=e.room,s=e.displayer;return t?()=>t.calibrationTimestamp:s?()=>s.beginTimestamp+s.progressTime:()=>Date.now()}function b(e){return e.displayer.logger}function p(e){try{let t=window.getComputedStyle(e).backgroundColor;if(t!=="rgba(0, 0, 0, 0)"&&t!=="transparent")return t=h(t),console.log("[Slide] guess bg color:",t),t;if(e.parentElement)return p(e.parentElement)}catch{}return"#ffffff"}function h(e){const t=f.exports.get(e);if(t&&t.model==="rgb"){const s=t.value,r=(((Math.round(s[0])&255)<<16)+((Math.round(s[1])&255)<<8)+(Math.round(s[2])&255)).toString(16);return"#"+"000000".substring(r.length)+r}else return e}function y(e,t){e.emitter.on("destroy",t)}function k({context:e,viewer:t,sideEffect:s,logger:o}){const r=o.info.bind(o);let n=null;t.prepare(({width:a,height:l,slideCount:u})=>{e.destroyed||(a&&e.box.setStageRatio(l/a),n=e.createWhiteBoardView({size:u}),n.setBaseRect({width:a,height:l}),g())});const{slide:i}=t;function g(){if(e.storage.state.state)r("[Slide] restore",{...e.storage.state.state}),i.setSlideState(e.storage.state.state);else if(e.isAddApp)r("[Slide] kick start"),i.renderSlide(1);else{r("[Slide] wait for restore");const a=s.add(()=>{const u=setInterval(()=>{e.storage.state.state||(r("[Slide] timeout"),i.renderSlide(1))},15e3);return()=>clearInterval(u)}),l=s.addDisposer(e.storage.addStateChangedListener(()=>{e.storage.state.state&&(r("[Slide] restore",{...e.storage.state.state}),i.setSlideState(e.storage.state.state),s.flush(l),s.flush(a))}))}}i.on("stateChange",()=>{e.isWritable&&(r("[Slide] save state",{...i.slideState}),e.storage.setState({state:i.slideState}))}),i.on("syncDispatch",a=>{e.isWritable&&(r("[Slide] dispatch",{...a}),e.dispatchMagixEvent("syncDispatch",a))}),s.addDisposer(e.addMagixEventListener("syncDispatch",({payload:a})=>{r("[Slide] receive",{...a}),i.emit("syncReceive",a)},{fireSelfEventAfterCommit:!0})),i.on("slideChange",a=>{e.isWritable&&n&&(r("[Slide] page to",a),n.jumpPage(a-1))}),t.setReadonly(!e.isWritable),s.addDisposer(e.emitter.on("writableChange",a=>{t.setReadonly(!a)}))}export{R as SlideViewer,A as addHooks,D as default,I as previewSlide,$ as refrigerator,v as version};
