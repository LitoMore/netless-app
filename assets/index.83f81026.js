import{S as F,i as H,s as J,e as v,b as d,d as G,f as S,g,l as C,k as V,a as L,h as U,t as R,j as B,c as O,n as E,O as K,m as M}from"./index.0e2cc17c.js";import"./modulepreload-polyfill.b7f2da20.js";const I=""+new URL("pencil.614cc8ea.svg",import.meta.url).href,q=""+new URL("pencil-off.f49ce2a4.svg",import.meta.url).href,N=""+new URL("plus.4b34cdbf.svg",import.meta.url).href,Q=""+new URL("close.c4eb3b01.svg",import.meta.url).href,X=""+new URL("up.c9e084a4.svg",import.meta.url).href;function D(l,t,e){const n=l.slice();return n[16]=t[e],n[17]=t,n[18]=e,n}function W(l){let t,e,n,c,p,s;return{c(){t=v("button"),e=v("img"),d(e,"draggable","false"),G(e.src,n=N)||d(e,"src",n),d(e,"alt","add"),d(t,"title","Add"),t.disabled=c=l[1].length>=20},m(i,r){S(i,t,r),g(t,e),p||(s=C(t,"click",l[7]),p=!0)},p(i,r){r&2&&c!==(c=i[1].length>=20)&&(t.disabled=c)},d(i){i&&V(t),p=!1,s()}}}function j(l){let t,e,n,c,p;return{c(){t=v("button"),e=v("img"),d(e,"draggable","false"),G(e.src,n=l[4]?q:I)||d(e,"src",n),d(e,"alt","edit"),d(t,"title","Edit")},m(s,i){S(s,t,i),g(t,e),c||(p=C(t,"click",l[5]),c=!0)},p(s,i){i&16&&!G(e.src,n=s[4]?q:I)&&d(e,"src",n)},d(s){s&&V(t),c=!1,p()}}}function z(l){let t,e,n=(l[2][l[18]]||0)+"",c,p,s,i,r,_,u,m;function k(){return l[12](l[18])}return{c(){t=v("span"),e=R("("),c=R(n),p=R(")"),s=L(),i=v("button"),r=v("img"),d(t,"class","netless-app-vote-count"),d(r,"draggable","false"),G(r.src,_=X)||d(r,"src",_),d(r,"alt","vote"),d(i,"title","Vote")},m(a,b){S(a,t,b),g(t,e),g(t,c),g(t,p),S(a,s,b),S(a,i,b),g(i,r),u||(m=C(i,"click",k),u=!0)},p(a,b){l=a,b&4&&n!==(n=(l[2][l[18]]||0)+"")&&B(c,n)},d(a){a&&V(t),a&&V(s),a&&V(i),u=!1,m()}}}function P(l){let t,e,n,c,p;function s(){return l[13](l[18])}return{c(){t=v("button"),e=v("img"),d(e,"draggable","false"),G(e.src,n=Q)||d(e,"src",n),d(e,"alt","delete"),d(t,"title","Delete")},m(i,r){S(i,t,r),g(t,e),c||(p=C(t,"click",s),c=!0)},p(i,r){l=i},d(i){i&&V(t),c=!1,p()}}}function T(l){let t,e,n,c,p,s,i,r;function _(){l[11].call(e,l[17],l[18])}let u=!l[4]&&z(l),m=l[4]&&P(l);return{c(){t=v("li"),e=v("input"),c=L(),u&&u.c(),p=L(),m&&m.c(),s=L(),d(e,"class","netless-app-vote-item"),e.readOnly=n=!l[4]},m(k,a){S(k,t,a),g(t,e),U(e,l[16]),g(t,c),u&&u.m(t,null),g(t,p),m&&m.m(t,null),g(t,s),i||(r=C(e,"input",_),i=!0)},p(k,a){l=k,a&16&&n!==(n=!l[4])&&(e.readOnly=n),a&2&&e.value!==l[16]&&U(e,l[16]),l[4]?u&&(u.d(1),u=null):u?u.p(l,a):(u=z(l),u.c(),u.m(t,p)),l[4]?m?m.p(l,a):(m=P(l),m.c(),m.m(t,s)):m&&(m.d(1),m=null)},d(k){k&&V(t),u&&u.d(),m&&m.d(),i=!1,r()}}}function Y(l){let t,e,n,c,p,s,i=(l[0]||"what to eat")+"",r,_,u,m,k,a=l[4]&&W(l),b=l[3]&&j(l),y=l[1],h=[];for(let f=0;f<y.length;f+=1)h[f]=T(D(l,y,f));return{c(){t=v("div"),e=v("div"),a&&a.c(),n=L(),b&&b.c(),c=L(),p=v("div"),s=v("h2"),r=R(i),_=L(),u=v("ul");for(let f=0;f<h.length;f+=1)h[f].c();d(e,"class","netless-app-vote-controls"),d(s,"contenteditable",l[4]),O(s,"editing",l[4]),d(p,"class","netless-app-vote-title"),d(u,"class","netless-app-vote-items"),d(t,"class","netless-app-vote"),d(t,"data-kind","vote")},m(f,w){S(f,t,w),g(t,e),a&&a.m(e,null),g(e,n),b&&b.m(e,null),g(t,c),g(t,p),g(p,s),g(s,r),g(t,_),g(t,u);for(let o=0;o<h.length;o+=1)h[o].m(u,null);m||(k=C(s,"input",l[6]),m=!0)},p(f,[w]){if(f[4]?a?a.p(f,w):(a=W(f),a.c(),a.m(e,n)):a&&(a.d(1),a=null),f[3]?b?b.p(f,w):(b=j(f),b.c(),b.m(e,null)):b&&(b.d(1),b=null),w&1&&i!==(i=(f[0]||"what to eat")+"")&&B(r,i),w&16&&d(s,"contenteditable",f[4]),w&16&&O(s,"editing",f[4]),w&790){y=f[1];let o;for(o=0;o<y.length;o+=1){const A=D(f,y,o);h[o]?h[o].p(A,w):(h[o]=T(A),h[o].c(),h[o].m(u,null))}for(;o<h.length;o+=1)h[o].d(1);h.length=y.length}},i:E,o:E,d(f){f&&V(t),a&&a.d(),b&&b.d(),K(h,f),m=!1,k()}}}function Z(l,t,e){let n;const c=M();let{writable:p=!1}=t,{title:s=""}=t,{items:i=["lorem","ipsum","dolo","sit","amet"]}=t,{votes:r=[0,0,0,0,0]}=t,_="vote";function u(){e(10,_=n?"vote":"edit"),_==="vote"&&(e(2,r=Array(i.length).fill(0)),b())}function m(o){e(0,s=o.target.textContent||"")}function k(){e(1,i=i.concat([""]))}function a(o){e(1,i=i.slice(0,o).concat(i.slice(o+1)))}function b(){p&&(r.forEach((o,A)=>{c("update",{votes:[A,o]})}),c("update",{title:s,items:i}))}function y(o){p&&c("update",{votes:[o,r[o]+1]})}function h(o,A){o[A]=this.value,e(1,i)}const f=o=>y(o),w=o=>a(o);return l.$$set=o=>{"writable"in o&&e(3,p=o.writable),"title"in o&&e(0,s=o.title),"items"in o&&e(1,i=o.items),"votes"in o&&e(2,r=o.votes)},l.$$.update=()=>{l.$$.dirty&1024&&e(4,n=_==="edit")},[s,i,r,p,n,u,m,k,a,y,_,h,f,w]}class x extends F{constructor(t){super(),H(this,t,Z,Y,J,{writable:3,title:0,items:1,votes:2})}}const $=`.netless-app-vote{width:100%;height:100%;background-color:#fff;display:flex;flex-flow:column nowrap}.netless-app-vote [contenteditable=true]{border-bottom:1px dashed #ccc}.netless-app-vote button{height:25px;gap:4px;background-color:transparent;border:2px solid transparent;border-radius:4px}.netless-app-vote button:hover{border-color:#ccc}.netless-app-vote button:active{background-color:#ccc}.netless-app-vote button img{width:16px;height:16px}.netless-app-vote-controls{position:absolute;top:8px;right:8px}.netless-app-vote-title{padding:8px}.netless-app-vote-title h2{margin:0;padding:2px 8px;display:inline-block;line-height:1.1;color:#333;border-bottom:1px dashed transparent}.netless-app-vote-items{flex-grow:1;margin:0;padding:0 8px 12px;list-style-type:none;overflow-y:auto}.netless-app-vote-items li{display:flex;align-items:center;gap:5px;line-height:1.5;padding-bottom:4px}.netless-app-vote-items li button{display:inline-block}.netless-app-vote-item{display:block;font-size:16px;line-height:1.5;font-family:Arial,sans-serif;flex-grow:1;border:1px solid #eee;border-radius:4px;padding:2px 8px}.netless-app-vote-item[readonly]{border-color:transparent}.netless-app-vote-count{padding-right:8px;font-variant-numeric:tabular-nums}.telebox-color-scheme-dark .netless-app-vote{color-scheme:dark;background-color:#121212;color:#eee}.telebox-color-scheme-dark [contenteditable=true]{border-bottom-color:#666}.telebox-color-scheme-dark button:hover{border-color:#666}.telebox-color-scheme-dark button:active{background-color:#666}.telebox-color-scheme-dark button img{filter:invert(1)}.telebox-color-scheme-dark .netless-app-vote-title h2{color:#ccc}.telebox-color-scheme-dark .netless-app-vote-item{border-color:#666}
`,le={kind:"Vote",setup(l){const t=l.box,e=l.createStorage("vote",{title:"",items:[]});t.mountStyles($);const n=new x({target:t.$content,props:{writable:l.isWritable,title:e.state.title,items:e.state.items,votes:e.state.items.map((s,i)=>e.state[`item-${i}`]||0)}}),c=l.emitter.on("writableChange",()=>{n.$set({writable:l.isWritable})});n.$on("update",({detail:s})=>{if("title"in s&&e.setState({title:s.title}),"items"in s&&e.setState({items:s.items}),Array.isArray(s.votes)){const[i,r]=s.votes;e.setState({[`item-${i}`]:r})}});const p=e.addStateChangedListener(s=>{if(console.log(e.state),s.title)n.$set({title:s.title.newValue});else{const i=e.state.items.map((r,_)=>e.state[`item-${_}`]||0);n.$set({items:e.state.items,votes:i})}});l.emitter.on("destroy",()=>{c(),p(),n.$destroy()})}};export{le as default};
