import{w as m,ak as u,al as S,am as f}from"./index.f98fa641.js";import{ak as A,an as P,al as L}from"./index.f98fa641.js";import"./modulepreload-polyfill.b7f2da20.js";const D=void 0,w={kind:"Slide",setup(e){var o,l;if(console.log("[Slide] setup @ "+void 0),!e.storage.state.taskId)throw new Error("[Slide] no taskId");const t=e.getAppOptions()||{},r=t.renderOptions||{},i=b(e,t.debug);i.info("[Slide] setup @ "+void 0);const s=new m,n=new u({interactive:!0,mode:"interactive",resize:!0,enableGlobalClick:!0,timestamp:c(e),logger:i,renderOptions:{minFPS:r.minFPS||25,maxFPS:r.maxFPS||30,autoFPS:(o=r.autoFPS)!=null?o:!0,autoResolution:(l=r.autoResolution)!=null?l:!0,resolution:r.resolution,maxResolutionLevel:r.maxResolutionLevel,transactionBgColor:r.transactionBgColor||p(e.box.$content)},rtcAudio:t.rtcAudio,useLocalCache:t.useLocalCache,resourceTimeout:t.resourceTimeout,loaderDelegate:t.loaderDelegate,navigatorDelegate:t.navigatorDelegate,fixedFrameSize:t.fixedFrameSize,taskId:e.storage.state.taskId,url:e.storage.state.url});n.context=e,s.addDisposer(S.set(e.appId,n)),e.box.mountStyles(u.styles),e.box.mountStage(n.$slide),e.box.mountFooter(n.$footer),e.box.mountContent(n.$content),s.addDisposer(()=>n.destroy()),k({context:e,viewer:n,sideEffect:s,logger:i}),y(e,()=>{i.info("[Slide] destroy"),s.flushAll()})}};function F(e){const{container:t,...r}=e;t.style.cssText="display:flex;flex-direction:column";const i=new u(r);return t.appendChild(document.createElement("style")).textContent=u.styles,t.appendChild(i.$content),t.appendChild(i.$footer),i.prepare(()=>i.slide.renderSlide(1)),i}function c(e){const t=e.room,r=e.displayer;return t?()=>t.calibrationTimestamp:r?()=>r.beginTimestamp+r.progressTime:()=>Date.now()}function b(e,t){return e.displayer.logger}function p(e){try{let t=window.getComputedStyle(e).backgroundColor;if(t!=="rgba(0, 0, 0, 0)"&&t!=="transparent")return t=h(t),console.log("[Slide] guess bg color:",t),t;if(e.parentElement)return p(e.parentElement)}catch{}return"#ffffff"}function h(e){const t=f.exports.get(e);if(t&&t.model==="rgb"){const r=t.value,s=(((Math.round(r[0])&255)<<16)+((Math.round(r[1])&255)<<8)+(Math.round(r[2])&255)).toString(16);return"#"+"000000".substring(s.length)+s}else return e}function y(e,t){e.emitter.on("destroy",t)}function k({context:e,viewer:t,sideEffect:r,logger:i}){const s=i.info.bind(i);let n=null;t.prepare(({width:a,height:d,slideCount:g})=>{e.destroyed||(a&&e.box.setStageRatio(d/a),n=e.createWhiteBoardView({size:g}),n.setBaseRect({width:a,height:d}),l())});const{slide:o}=t;function l(){if(e.storage.state.state)s("[Slide] restore",{...e.storage.state.state}),o.setSlideState(e.storage.state.state);else if(e.isAddApp)s("[Slide] kick start"),o.renderSlide(1);else{s("[Slide] wait for restore");const a=r.add(()=>{const g=setInterval(()=>{e.storage.state.state||(s("[Slide] timeout"),o.renderSlide(1))},15e3);return()=>clearInterval(g)}),d=r.addDisposer(e.storage.addStateChangedListener(()=>{e.storage.state.state&&(s("[Slide] restore",{...e.storage.state.state}),o.setSlideState(e.storage.state.state),r.flush(d),r.flush(a))}))}}o.on("stateChange",()=>{e.isWritable&&(s("[Slide] save state",{...o.slideState}),e.storage.setState({state:o.slideState}))}),o.on("syncDispatch",a=>{e.isWritable&&(s("[Slide] dispatch",{...a}),e.dispatchMagixEvent("syncDispatch",a))}),r.addDisposer(e.addMagixEventListener("syncDispatch",({payload:a})=>{s("[Slide] receive",{...a}),o.emit("syncReceive",a)},{fireSelfEventAfterCommit:!0})),o.on("slideChange",a=>{e.isWritable&&n&&(s("[Slide] page to",a),n.jumpPage(a-1))}),t.setReadonly(!e.isWritable),r.addDisposer(e.emitter.on("writableChange",a=>{t.setReadonly(!a)}))}export{A as SlideViewer,P as addHooks,w as default,F as previewSlide,L as refrigerator,D as version};
